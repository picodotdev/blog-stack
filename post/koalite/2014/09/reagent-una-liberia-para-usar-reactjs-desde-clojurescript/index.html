<!DOCTYPE html><html data-debug-enabled="true" data-locale="es_ES" xmlns="http://www.w3.org/1999/xhtml"><head><meta content="Apache Tapestry Framework (version 5.4-beta-16)" name="generator"/><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><meta pagina="Post"/><title>Reagent, una libería para usar ReactJS desde ClojureScript | Koalite</title><!-- Resources --><link type="text/css" rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:400,700"/><link type="text/css" rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css"/><link title="Portada" type="application/atom+xml" rel="alternate" href="/feed.atom.xml"/><link type="image/png" rel="icon" href="/assets/images/favicon.png"/><meta content="Post" name="tapestry-page-name"/><link type="text/css" rel="stylesheet" href="/assets/tapestry5/bootstrap/css/bootstrap.css"/><link type="text/css" rel="stylesheet" href="/assets/tapestry5/tapestry.css"/><link type="text/css" rel="stylesheet" href="/assets/tapestry5/exception-frame.css"/><link type="text/css" rel="stylesheet" href="/assets/tapestry5/tapestry-console.css"/><link type="text/css" rel="stylesheet" href="/assets/tapestry5/tree.css"/><link type="text/css" rel="stylesheet" href="/assets/css/core.css"/></head><body data-page-initialized="false"><script type="text/javascript">document.write("<div class=\"pageloading-mask\"><div></div></div>");</script><header><div class="container-fluid"><div class="row"><div class="col-xs-12 col-sm-12 col-md-4"><h1><a class="blogstack" href="/"><span class="glyphicon glyphicon-th"></span> Blog <span class="stack">Stack</span></a></h1></div><div class="col-xs-12 col-sm-12 col-md-6"><nav role="navigation"><ul class="list-unstyled list-inline"><li><a class="header" href="/">Inicio</a></li><li><a class="header" href="/archive">Archivo</a></li><li><a class="header" href="/faq">Preguntas frecuentes</a></li><li><a class="header" href="/faq#aggregate">¿Quieres agregar tu bitácora?</a></li></ul></nav></div><div class="col-xs-6 col-sm-6 col-md-2"><a title="Fuente RSS, ¡suscríbete a BS!" alt="Fuente RSS" class="header" href="/feed.atom.xml"><span class="header icon entypo"></span></a><a title="Twitter, ¡sigue a BS!" alt="Twitter" class="header" href="http://twitter.com/blogstackinfo"><span class="header icon entypo-social"></span></a></div></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><h4>Un poco más que un agregador/planeta de bitácoras sobre programación, desarrollo, software libre, gnu/linux, tecnología, ...</h4></div></div></div><div class="container-fluid"><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><div class="imagen-cabecera"><div class="imagen"><div class="col-xs-12 col-sm-12 col-md-12" id="billboard"></div></div></div></div></div></div></header><div class="container-fluid content"><div class="row"><div class="col-xs-12 col-sm-12 col-md-8 content"><article itemtype="http://schema.org/BlogPosting" itemscope=""><a id="content"></a><header><h2><a href="/post/koalite/2014/09/reagent-una-liberia-para-usar-reactjs-desde-clojurescript"><span itemprop="headline">Reagent, una libería para usar ReactJS desde ClojureScript</span></a></h2></header><section class="post-data"><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><div><span>Escrito por <span itemprop="author">Juan María Hernández</span> en la bitácora <a href="http://blog.koalite.com/">Koalite</a>, <a href="http://feedproxy.google.com/~r/KoalitesBlog/~3/ipOm5Nzq6GQ/"><span itemprop="sameAs">artículo original</span></a></span></div><div><span datetime="2014-09-29T05:06" itemprop="datePublished">Publicado el lunes, 29 de septiembre de 2014 a las 05:06 UTC</span></div><div><span>
Etiquetado como
clojure, development, reactjs, reagent</span></div></div></div></section><div class="text-justify post-content"><div class="share-this only-twitter"><span displayText="Tweet" class="st_twitter_vcount" st_url="http://www.blogstack.info/post/koalite/2014/09/reagent-una-liberia-para-usar-reactjs-desde-clojurescript" st_title="Reagent, una libería para usar ReactJS desde ClojureScript | Koalite"></span></div><script src="http://w.sharethis.com/button/buttons.js" type="text/javascript"></script><script type="text/javascript">stLight.options({publisher: "ur-3b2014fd-82e-9968-7e00-5ee51fb88bb2", doNotHash: true, doNotCopy: true, hashAddressBar: false});</script><span itemprop="name"><p>Despu&eacute;s de <a href="http://blog.koalite.com/2014/09/reactjs-un-enfoque-diferente/" title="ReactJS: un enfoque diferente">conocer un poco con ReactJS</a>, hacer un peque&ntilde;o <a href="http://blog.koalite.com/2014/09/crear-un-componente-con-reactjs/" title="Crear un componente con ReactJS">ejemplo con ReactJS</a> y ver c&oacute;mo pod&iacute;amos <a href="http://blog.koalite.com/2014/09/como-utilizar-reactjs-con-browserify/" title="C&oacute;mo utilizar ReactJS con Browserify">automatizar la compilaci&oacute;n de aplicaciones basadas en ReactJS</a>, ha llegado el momento de cambiar de lenguaje y ver c&oacute;mo podemos utilizar ReactJS desde ClojureScript.</p> 
<p>ClojureScript es una implementaci&oacute;n de <a href="http://blog.koalite.com/tag/clojure/">Clojure</a> que permite compilar c&oacute;digo Clojure a Javascript, con lo que podemos ejecutarlo en el browser o incluso en plataformas como Node.js, en lugar de usar la JVM como motor de ejecuci&oacute;n. Como era de esperar, con ClojureScript podemos utilizar las APIs nativas del navegador, pero adem&aacute;s existen librer&iacute;as que nos permiten trabajar de una forma m&aacute;s <em>idiom&aacute;tica</em>. </p> 
<p>En el caso concreto de ReactJS, hay varias alternativas para utilizarlo desde ClojureScript. La m&aacute;s completa seguramente sea <a href="https://github.com/swannodette/om">Om</a>, que no s&oacute;lo ofrece un interface sobre ReactJS sino que adem&aacute;s aprovecha otras caracter&iacute;sticas “modernas” de Clojure (como los canales de <a href="https://github.com/clojure/core.async">core.async</a>). Esto hace que sea una librer&iacute;a algo m&aacute;s intrusiva que el propio ReactJS, puesto que cubre un &aacute;rea mayor de la aplicaci&oacute;n en lugar de limitarse a la pura generaci&oacute;n del DOM.</p> 
<p>En este post vamos a ver otra alternativa, <a href="http://holmsand.github.io/reagent/">reagent</a>, que se define a si misma como <em>un interface minimalista entre ReactJS y ClojureScript</em>, y que no es m&aacute;s que eso, una peque&ntilde;a capa de abstracci&oacute;n sobre ReactJS para poder escribir componentes de ReactJS de una forma m&aacute;s c&oacute;moda desde ClojureScript.</p> 
<h3>&iquest;Por qu&eacute; ClojureScript?</h3> 
<p>Dada la cantidad de lenguajes que compilan (o transpilan, seg&uacute;n se mire) a Javascript, es razonable preguntarse por qu&eacute; usar ClojureScript en lugar de, por ejemplo, TypeScript o ClojureScript.</p> 
<p>Dejando de lado las bondades de Clojure como lenguaje, hay un par de factores que hacen que me parezca especialmente interesante la integraci&oacute;n entre ClojureScript y ReactJS.</p> 
<p>Por una parte, como vimos <a href="http://blog.koalite.com/2014/09/reactjs-un-enfoque-diferente/" title="ReactJS: un enfoque diferente">en el primer post de esta serie</a>, ReactJS hace una distinci&oacute;n muy f&eacute;rrea entre la informaci&oacute;n mutable (<code>state</code>) y la informaci&oacute;n inmutable (<code>props</code>). Esto cuadra muy bien con la filosof&iacute;a de Clojure, en la que <strong>por defecto la informaci&oacute;n es inmutable</strong> y existen mecanismos, como <a href="http://blog.koalite.com/2013/03/tutorial-compojure-iii-usando-atoms-como-modelo-de-datos/" title="Tutorial Compojure III: Usando atoms como modelo de datos">los <code>atom</code></a> para gestionar de forma expl&iacute;cita la mutabilidad.</p> 
<p>Esto hace adem&aacute;s que podamos <strong>mejorar el ya de por si excelente rendimiento de ReactJS</strong>. ReactJS utiliza un modelo de DOM Virtual sobre el que calcula diferencias para optimizar el renderizado en pantalla reduciendo al m&aacute;ximo el n&uacute;mero de operaciones lanzadas sobre el DOM real. Para ello, necesita comparar las distintas versiones del DOM virtual y as&iacute; detectar los cambios. Puesto que la mayor&iacute;a de la informaci&oacute;n en Clojure se almacena en estructuras de datos persistentes (inmutables), esta comparaci&oacute;n puede hacerse muchas veces realizando una simple comparaci&oacute;n por referencia, lo que evita tener que recorrer estructuras de datos complejas para detectar cambios, acelerando as&iacute; el proceso de renderizado a&uacute;n m&aacute;s.</p> 
<p>Por otro lado, y esto es una cuesti&oacute;n m&aacute;s personal, en ReactJS se utiliza una sintaxis especial, el JSX, para “mezclar” javascript con HTML a la hora de generar el DOM. En Clojure es frecuente utilizar t&eacute;cnicas similares, con librer&iacute;as como <a href="http://blog.koalite.com/2013/03/tutorial-compojure-ii-generando-vistas-con-hiccup/" title="Tutorial Compojure II: Generando vistas con Hiccup">Hiccup</a>, por lo que esta forma de trabajar resulta bastante idiom&aacute;tica.</p> 
<h3>Un ejemplo</h3> 
<p>No voy a entrar en mucho detalle de c&oacute;mo funciona ClojureScript (eso dar&iacute;a para un par de posts), pero vamos a ver un ejemplo de uso muy b&aacute;sico de reagent para poder compararlo con ReactJS. </p> 
<p>Partiremos <a href="http://blog.koalite.com/2014/09/crear-un-componente-con-reactjs/" title="Crear un componente con ReactJS">del mismo ejemplo de la lista de cervezas</a>, en el que pretend&iacute;amos construir un interface como &eacute;ste:</p> 
<p><img src="http://blog.koalite.com/wp-content/uploads/react-sample.png" alt="react-sample" width="312" height="134" /></p> 
<p>En ReactJS, la forma de implementar cada componente era definiendo un objeto a trav&eacute;s de la funci&oacute;n <code>React.createClass</code>:</p> 
<pre>
var BeerList = React.createClass({
  render: function() {...}
});
</pre> 
<p>Con reagent, la forma m&aacute;s simple de implementar una funci&oacute;n es a trav&eacute;s de una funci&oacute;n. Un componente en reagent no es m&aacute;s que una funci&oacute;n que devuelve el DOM que se debe generar. Para ello, cuenta con una sintaxis parecida a la de <a href="http://blog.koalite.com/2013/03/tutorial-compojure-ii-generando-vistas-con-hiccup/" title="Tutorial Compojure II: Generando vistas con Hiccup">hiccup</a>, y la informaci&oacute;n inmutable que recibe el componente (las <code>props</code> de ReactJS) son directamente los par&aacute;metros que recibe la funci&oacute;n. Existen otras alternativas para cubrir casos m&aacute;s complejos, pero de momento nos quedaremos con esta forma de trabajar.</p> 
<p>Partiendo de esto, el componente que muestra la informaci&oacute;n de una cerveza ser&iacute;a algo tan simple como esto:</p> 
<pre>
(defn beer-item [beer count]
  [:li &quot;[&quot; count &quot;] &quot; beer
   [:button {:on-click #(add-one! beer)} &quot;Otra m&aacute;s&quot;]])
</pre> 
<p>Se trata de una funci&oacute;n que recibe el nombre de la cerveza (<code>beer</code>) y las unidades consumidas hasta el momento (<code>count</code>) y genera el DOM necesario. </p> 
<p>Para el componente que genera la lista completa, tendr&iacute;amos algo as&iacute;:</p> 
<pre>
(defn beer-list []
  (let [total (reduce + (vals @beers))
        items (map (fn [[name count]] (beer-item name count)) @beers)]
    [:div
     [:p &quot;Llevas &quot; total  &quot; cervezas&quot;]
     [:ul items]]))
</pre> 
<p>Aqu&iacute; podemos ver una diferencia entre la manera de gestionar el estado mutable en ReactJS y en Reagent. En ReactJS es necesario utilizar las funciones <code>getInitialState</code>, <code>setState</code> y <code>getState</code> para tratar con el estado mutable, porque era necesario que la librer&iacute;a pudiese detectar cambios en el estado y as&iacute; forzar el renderizado del componente que pose&iacute;a ese estado.</p> 
<p>En reagent se utilizan <code>atom</code>s para almacenar el estado mutable. Estos <code>atom</code>s no son exactamente los mismos que en Clojure, sino que son una implementaci&oacute;n propia de reagent con algunas caracter&iacute;sticas especiales, pero exponen el mismo API que un <code>atom</code> de Clojure (y que pod&eacute;is consultar en <a href="http://blog.koalite.com/2013/03/tutorial-compojure-iii-usando-atoms-como-modelo-de-datos/" title="Tutorial Compojure III: Usando atoms como modelo de datos">este post</a>). A trav&eacute;s de los <code>atom</code>s reagent puede detectar cuando se producen cambios en el estado y volver a renderizar a los componentes necesarios. </p> 
<p>Aunque en el ejemplo se est&aacute; utilizando un <code>atom</code> definido globalmente, es posible trabajar con <code>atom</code>s locales a cada componente si tiene m&aacute;s sentido. </p> 
<p>El c&oacute;digo completo del ejemplo ser&iacute;a &eacute;ste:</p> 
<pre>
(ns reagent-cljs.core
  (:require [reagent.core :as r]))

(enable-console-print!)

(def beers
  (r/atom {&quot;Mahou 5 Estrellas&quot; 0
           &quot;Chimay triple&quot; 0
           &quot;Cibeles Imperial IPA&quot; 0}))

(defn add-one! [beer]
  (swap! beers update-in [beer] inc))

(defn beer-item [beer count]
  [:li &quot;[&quot; count &quot;] &quot; beer
   [:button {:on-click #(add-one! beer)} &quot;Otra m&aacute;s&quot;]])

(defn beer-list []
  (let [total (reduce + (vals @beers))
        items (map (fn [[name count]] (beer-item name count)) @beers)]
    [:div
     [:p &quot;Llevas &quot; total  &quot; cervezas&quot;]
     [:ul items]]))

(r/render-component [beer-list] (.-body js/document))
</pre> 
<p>Si ten&eacute;is curiosidad por ver c&oacute;mo se estructura un proyecto de ClojureScript (o al menos una de las formas de estructurarlo), pod&eacute;is <a href="https://github.com/jmhdez/reagent-sample">echarle un vistazo en GitHub</a>. </p> 
<p>Una vez instalado <a href="http://blog.koalite.com/2013/01/estructura-de-un-proyecto-con-clojure/" title="Estructura de un proyecto con Clojure">leiningen</a> y clonado el repositorio, tan s&oacute;lo necesit&aacute;is ejecutar:</p> 
<pre>
lein cljsbuild auto
</pre> 
<p>El c&oacute;digo se generar&aacute; cada vez que se modifique alg&uacute;n fichero y podr&eacute;is ver la p&aacute;gina en funcionamiento abriendo el archivo <code>index.html</code> de la ra&iacute;z del proyecto.</p> 
<h3>Resumen</h3> 
<p>Algunas de las ideas subyacentes a ReactJS hacen que encaje muy bien con un lenguaje como ClojureScript, especialmente por el tratamiento de la (im)mutabilidad y, en menor medida, por el uso de una sintaxis embebida en el propio lenguaje para la generaci&oacute;n del DOM.</p> 
<p>Reagent ofrece un interface simple sobre ReactJS para hacer que usarlo desde ClojureScript sea una experiencia muy c&oacute;moda. Como se puede ver en el ejemplo, el c&oacute;digo que resulta mantiene un estilo muy t&iacute;pico de Clojure y aprovecha bastante bien las caracter&iacute;sticas de este lenguaje.</p> 
<p><strong>Posts relacionados:</strong></p>
<ol> 
 <li><a href="http://blog.koalite.com/2014/09/crear-un-componente-con-reactjs/" title="Crear un componente con ReactJS">Crear un componente con ReactJS</a></li> 
 <li><a href="http://blog.koalite.com/2014/09/como-utilizar-reactjs-con-browserify/" title="C&oacute;mo utilizar ReactJS con Browserify">C&oacute;mo utilizar ReactJS con Browserify</a></li> 
 <li><a href="http://blog.koalite.com/2014/09/reactjs-un-enfoque-diferente/" title="ReactJS: un enfoque diferente">ReactJS: un enfoque diferente</a></li> 
</ol>
<img src="http://feeds.feedburner.com/~r/KoalitesBlog/~4/ipOm5Nzq6GQ" height="1" width="1" /></span></div><section><a id="share"></a><h1>Compartir</h1><div class="share-this"><span displayText="Tweet" class="st_twitter_vcount" st_url="http://www.blogstack.info/post/koalite/2014/09/reagent-una-liberia-para-usar-reactjs-desde-clojurescript" st_title="Reagent, una libería para usar ReactJS desde ClojureScript | Koalite"></span><span displayText="Facebook" class="st_facebook_vcount" st_url="http://www.blogstack.info/post/koalite/2014/09/reagent-una-liberia-para-usar-reactjs-desde-clojurescript" st_title="Reagent, una libería para usar ReactJS desde ClojureScript | Koalite"></span><span displayText="Google +" class="st_googleplus_vcount" st_url="http://www.blogstack.info/post/koalite/2014/09/reagent-una-liberia-para-usar-reactjs-desde-clojurescript" st_title="Reagent, una libería para usar ReactJS desde ClojureScript | Koalite"></span><span displayText="LinkedIn" class="st_linkedin_vcount" st_url="http://www.blogstack.info/post/koalite/2014/09/reagent-una-liberia-para-usar-reactjs-desde-clojurescript" st_title="Reagent, una libería para usar ReactJS desde ClojureScript | Koalite"></span><span displayText="Meneame" class="st_meneame_vcount" st_url="http://www.blogstack.info/post/koalite/2014/09/reagent-una-liberia-para-usar-reactjs-desde-clojurescript" st_title="Reagent, una libería para usar ReactJS desde ClojureScript | Koalite"></span></div><script src="http://w.sharethis.com/button/buttons.js" type="text/javascript"></script><script type="text/javascript">stLight.options({publisher: "ur-3b2014fd-82e-9968-7e00-5ee51fb88bb2", doNotHash: true, doNotCopy: true, hashAddressBar: false});</script><div id="widget"></div></section><hr/></article></div><div class="col-xs-12 col-sm-12 col-md-4"><aside><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"></div></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><div id="bigRectangle"></div></div></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><section><h3>Redes sociales</h3><p>¿Te gusta Blog Stack? ¡Compártelo!</p><div class="social-networks"><!-- Facebook --><div class="social-network"><div data-share="true" data-show-faces="false" data-action="like" data-width="310" data-layout="box_count" data-href="http://www.blogstack.info/" class="fb-like"></div></div><!-- Google+ --><div class="social-network"><div class="g-plusone" data-href="http://www.blogstack.info/" data-size="tall"></div></div></div></section></div></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><section id="lastPosts"></section></div></div><div class="row"><div class="col-xs-3 col-md-2"><div id="wideSkycraper"></div></div></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><section id="lastPosts_0"></section></div></div></aside></div></div></div><footer><div class="container-fluid"><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><div class="footer"><a href="/">Blog Stack</a> por <a href="https://twitter.com/picodotdev/">pico.dev</a> está publicado bajo la licencia de software libre <a href="http://www.gnu.org/licenses/agpl-3.0.html">GNU Affero General Public</a> en <a href="https://github.com/picodotdev/blog-stack">GitHub <span class="entypo-social"></span></a>.<br/>
El contenido agregado conserva la licencia de su bitácora.<br/>
«Powered by» <a href="https://github.com/picodotdev/blogstack">Blog Stack</a>, <a href="http://tapestry.apache.org/">Apache Tapestry</a>, <a href="https://www.openshift.com/">OpenShift</a>, <a href="https://pages.github.com/">GitHub Pages</a>, <a href="http://www.oracle.com/es/technologies/java/overview/index.html">Java</a> y más software libre o de código abierto, inspirado en <a href="http://octopress.org/">Octopress</a>.<br/><span class="copyleft">©</span> pico.dev 2014
</div></div></div></div></footer><div id="fb-root"></div><script type="text/javascript">var require = {
  "waitSeconds" : 300,
  "shim" : {
    "t5/core/typeahead" : [
      "jquery"
    ],
    "bootstrap/affix" : [
      "bootstrap/transition"
    ],
    "bootstrap/alert" : [
      "bootstrap/transition"
    ],
    "bootstrap/modal" : [
      "bootstrap/transition"
    ],
    "bootstrap/tab" : [
      "bootstrap/transition"
    ],
    "bootstrap/transition" : [
      "jquery"
    ],
    "bootstrap/button" : [
      "bootstrap/transition"
    ],
    "bootstrap/scrollspy" : [
      "bootstrap/transition"
    ],
    "bootstrap/collapse" : [
      "bootstrap/transition"
    ],
    "bootstrap/dropdown" : [
      "bootstrap/transition"
    ],
    "bootstrap/tooltip" : [
      "bootstrap/transition"
    ],
    "bootstrap/carousel" : [
      "bootstrap/transition"
    ],
    "bootstrap/popover" : [
      "bootstrap/tooltip"
    ]
  },
  "baseUrl" : "/modules"
};
</script><script src="/assets/tapestry5/require.js" type="text/javascript"></script><script src="/assets/tapestry5/underscore-1.5.2.js" type="text/javascript"></script><script src="/assets/tapestry5/scriptaculous_1_9_0/prototype.js" type="text/javascript"></script><script src="/assets/tapestry5/scriptaculous_1_9_0/scriptaculous.js" type="text/javascript"></script><script src="/assets/tapestry5/scriptaculous_1_9_0/effects.js" type="text/javascript"></script><script src="/assets/tapestry5/t53-compatibility.js" type="text/javascript"></script><script src="/assets/tapestry5/jquery.js" type="text/javascript"></script><script src="/assets/tapestry5/jquery-noconflict.js" type="text/javascript"></script><script type="text/javascript">require(["t5/core/pageinit"], function(pi) { pi([], [
  "app/analytics",
  [
    "app/karmacracy:init",
    {
      "selector" : "#widget",
      "id" : 933,
      "url" : "http://www.blogstack.info/post/koalite/2014/09/reagent-una-liberia-para-usar-reactjs-desde-clojurescript"
    }
  ],
  "app/facebook",
  "app/googleplus",
  [
    "app/lastPosts:init",
    {
      "id" : "lastPosts",
      "source" : "koalite",
      "name" : "Koalite"
    }
  ],
  [
    "app/lastPosts:init",
    {
      "id" : "lastPosts_0",
      "source" : "blogstack",
      "name" : "Blog Stack"
    }
  ],
  [
    "app/adsensem:init",
    {
      "blogstack" : {
        "adClient" : "ca-pub-3533636310991304",
        "adSlotBillboard" : "1397019380",
        "adSlotHorizontalSkycraper" : "1397019380",
        "adSlotBigRectangle" : "2873752587",
        "adSlotWideSkycraper" : "1896546988"
      }
    }
  ]
]); });</script></body></html>