<!DOCTYPE html><html data-debug-enabled="true" data-locale="es_ES" xmlns="http://www.w3.org/1999/xhtml"><head><meta content="Apache Tapestry Framework (version 5.4-beta-16)" name="generator"/><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><meta pagina="Post"/><title>Extender las validaciones de Apache Tapestry | El blog de pico.dev</title><!-- Resources --><link type="text/css" rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:400,700"/><link type="text/css" rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css"/><link title="Portada" type="application/atom+xml" rel="alternate" href="/feed.atom.xml"/><link type="image/png" rel="icon" href="/assets/images/favicon.png"/><meta content="Post" name="tapestry-page-name"/><link type="text/css" rel="stylesheet" href="/assets/tapestry5/bootstrap/css/bootstrap.css"/><link type="text/css" rel="stylesheet" href="/assets/tapestry5/tapestry.css"/><link type="text/css" rel="stylesheet" href="/assets/tapestry5/exception-frame.css"/><link type="text/css" rel="stylesheet" href="/assets/tapestry5/tapestry-console.css"/><link type="text/css" rel="stylesheet" href="/assets/tapestry5/tree.css"/><link type="text/css" rel="stylesheet" href="/assets/css/core.css"/></head><body data-page-initialized="false"><script type="text/javascript">document.write("<div class=\"pageloading-mask\"><div></div></div>");</script><header><div class="container-fluid"><div class="row"><div class="col-xs-12 col-sm-12 col-md-4"><h1><a class="blogstack" href="/"><span class="glyphicon glyphicon-th"></span> Blog <span class="stack">Stack</span></a></h1></div><div class="col-xs-12 col-sm-12 col-md-6"><nav role="navigation"><ul class="list-unstyled list-inline"><li><a class="header" href="/">Inicio</a></li><li><a class="header" href="/archive">Archivo</a></li><li><a class="header" href="/faq">Preguntas frecuentes</a></li><li><a class="header" href="/faq#aggregate">¿Quieres agregar tu bitácora?</a></li></ul></nav></div><div class="col-xs-6 col-sm-6 col-md-2"><a title="Fuente RSS, ¡suscríbete a BS!" alt="Fuente RSS" class="header" href="/feed.atom.xml"><span class="header icon entypo"></span></a><a title="Twitter, ¡sigue a BS!" alt="Twitter" class="header" href="http://twitter.com/blogstackinfo"><span class="header icon entypo-social"></span></a></div></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><h4>Un poco más que un agregador/planeta de bitácoras sobre programación, desarrollo, software libre, gnu/linux, tecnología, ...</h4></div></div></div><div class="container-fluid"><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><div class="imagen-cabecera"><div class="imagen"><div class="col-xs-12 col-sm-12 col-md-12" id="billboard"></div></div></div></div></div></div></header><div class="container-fluid content"><div class="row"><div class="col-xs-12 col-sm-12 col-md-8 content"><article itemtype="http://schema.org/BlogPosting" itemscope=""><a id="content"></a><header><h2><a href="/post/elblogdepicodev/2012/07/extender-las-validaciones-de-apache-tapestry"><span itemprop="headline">Extender las validaciones de Apache Tapestry</span></a></h2></header><div class="row labels"><div class="col-md-12"><a class="label" href="/label/programacion"><img title="programacion" alt="programacion" src="/assets/images/labels/programacion.png"/></a><a class="label" href="/label/java"><img title="java" alt="java" src="/assets/images/labels/java.png"/></a><a class="label" href="/label/tapestry"><img title="tapestry" alt="tapestry" src="/assets/images/labels/tapestry.png"/></a></div></div><section class="post-data"><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><div><span>Escrito por <span itemprop="author">pico.dev</span> en la bitácora <a href="http://elblogdepicodev.blogspot.com.es/">El blog de pico.dev</a>, <a href="http://elblogdepicodev.blogspot.com/2012/07/extender-las-validaciones-de-apache.html"><span itemprop="sameAs">artículo original</span></a></span></div><div><span datetime="2012-07-13T23:14" itemprop="dateModified">Actualizado el viernes, 13 de julio de 2012 a las 23:14 UTC</span></div><div><span>
Etiquetado como
planeta-codigo, <a href="/label/programacion"><span itemprop="articleSection">programacion</span></a>, <a href="/label/tapestry"><span itemprop="articleSection">tapestry</span></a>, <a href="/label/java"><span itemprop="articleSection">java</span></a></span></div></div></div></section><div class="text-justify post-content"><div class="share-this only-twitter"><span displayText="Tweet" class="st_twitter_vcount" st_url="http://www.blogstack.info/post/elblogdepicodev/2012/07/extender-las-validaciones-de-apache-tapestry" st_title="Extender las validaciones de Apache Tapestry | El blog de pico.dev"></span></div><script src="http://w.sharethis.com/button/buttons.js" type="text/javascript"></script><script type="text/javascript">stLight.options({publisher: "ur-3b2014fd-82e-9968-7e00-5ee51fb88bb2", doNotHash: true, doNotCopy: true, hashAddressBar: false});</script><span itemprop="name"><div style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;">
 <img alt="Apache Tapestry" height="133" src="http://4.bp.blogspot.com/-OGvCbjBk0zU/TOq7Y6w6wfI/AAAAAAAAAiU/Pfuzt5kkDBQ/s320/tapestry.png" title="Apache Tapestry" width="320" />
</div>Si en la entrada anterior expliqu&eacute; 
<a href="http://elblogdepicodev.blogspot.com.es/2012/07/validaciones-de-datos-de-formularios.html">como realizar validaciones de formularios en Tapestry</a> en esta explicar&eacute; como crear nuevos validadores, como crear macros de validadores y como cambiar el decorador por defecto para mostrar los errores como deseemos.&nbsp;Estas tres cosas ayudar&aacute; a las aplicaciones tengan menos c&oacute;digo duplicado, el comportamiento sea consistente en toda la aplicaci&oacute;n y por tanto que el mantenimiento sea m&aacute;s sencillo cuando haya que hacer cambios.
<br />
<br />
<h4> 
 <div style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"></div>Crear nuevos validadores</h4>
<div style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"></div>Si los validadores por defecto de Tapestry no nos son suficientes necesitaremos crear algunos especificos para nuestras necesidades. Un ejemplo podr&iacute;a ser un campo donde permitamos introducir una cadena que tiene que pertenecer a un grupo de valores. Como es habitual en Tapestry siempre que necesitamos algo nuevo debemos implementar una interfaz o extender una clase. Para este caso podr&iacute;amos implementar la interfaz 
<a href="http://tapestry.apache.org/5.3.2/apidocs/org/apache/tapestry5/Validator.html">Validator</a> pero tambi&eacute;n es habitual que dispongamos de una clase abstracta de la que podamos extender e implemente la interfaz que necesitamos. Para un nuevo validador podemos utilizar 
<a href="http://tapestry.apache.org/5.3.2/apidocs/org/apache/tapestry5/validator/AbstractValidator.html">AbstractValidator</a>. Partiendo del c&oacute;digo de uno de los validadores que ya disponemos por defecto, podemos hacer uno nuevo para un valor que tiene que estar dentro de un grupo.
<br />
<br />
<div>
 <pre>public class In extends AbstractValidator&lt;String, String&gt; {<br />    public In() {<br />  super(String.class, String.class, &quot;in&quot;);<br /> }<br /><br /> public void validate(Field field, String constraintValue, MessageFormatter formatter, String value) throws ValidationException {<br />  List values = Arrays.asList(constraintValue.split(&quot;|&quot;));<br />  if (!values.contains(value))<br />   throw new ValidationException(buildMessage(formatter, field, constraintValue));<br /> }<br /><br /> public void render(Field field, String constraintValue, MessageFormatter formatter, MarkupWriter writer, FormSupport formSupport) {<br />  formSupport.addValidation(field, &quot;in&quot;, buildMessage(formatter, field, constraintValue), constraintValue);<br /> }<br /><br /> private String buildMessage(MessageFormatter formatter, Field field, String constraintValue) {<br />  return formatter.format(constraintValue, field.getLabel());<br /> }<br />}</pre>
</div>
<br />Una vez que tenemos la clase validadora tenemos que dar a conocer a Tapestry de su existencia, para ello debemos hacer una contribuci&oacute;n en el contenedor de dependencias:
<br />
<br />
<div>
 <pre>// ...en la clase del m&oacute;dulo de la aplicaci&oacute;n<br /><br />    public static void contributeFieldValidatorSource(MappedConfiguration&lt;String, Validato&gt; configuration) {<br />        configuration.add(&quot;in&quot;, new In());<br />    }<br />...</pre>
</div>
<br />En este momento la podemos usar en los campos de la siguiente forma: 
<br />
<br />
<div>
 <pre>&lt;t:label for=&quot;telefono&quot;&gt;: &lt;t:textfield t:id=&quot;telefonoField&quot; value=&quot;producto&quot; validate=&quot;in=coche|casa|televisi&oacute;n|libro&quot; label=&quot;Producto&quot;/&gt;</pre>
</div>
<br />
<h4> Como cambiar el decorador por defecto</h4>Cuando se producen errores de validaci&oacute;n, Tapestry se encarga de decorar los campos para marcarlos como que tienen errores para de tal forma que el usuario pueda actuar en consecuencia, esto se hace sin que tengamos que hacer nada por nuestra parte. El decorador por defecto cuando hay errores marca la etiqueta y el campo en rojo y a&ntilde;ade una imagen con una equis roja despu&eacute;s del campo. Eso puede no ser lo que queramos ya que la imagen de la equis puede hacer que se desmaqueten las cosas si estamos justos de espacio en la pantalla.
<br />
<br />Podemos personalizar la forma en que Tapestry decora los campos por defecto a&ntilde;adiendo elementos antes y despues de la etiqueta del campo y del campo mismo, tambi&eacute;n podemos a&ntilde;adir una clase de error a la etiqueta del campo y al campo de datos. Para ello debemos extender de la clase 
<a href="http://tapestry.apache.org/5.3.2/apidocs/org/apache/tapestry5/BaseValidationDecorator.html">BaseValidationDecorator</a> que nos proporciona los m&eacute;todos para realizar las personalizaciones.
<br />
<br />En este ejemplo a&ntilde;adimos una clase CSS a la etiqueta y al campo cuando el valor del campo no es v&aacute;lido. Tendremos que modificar el estilo de esa clase CSS que a&ntilde;adimos (&laquo;t-error&raquo;) para modificar su aspecto.
<br />
<br />
<div>
 <pre>...<br /><br />public final class AppValidationDecorator extends BaseValidationDecorator {<br /><br /> private final Environment environment;<br /><br /> private final MarkupWriter markupWriter;<br /><br /> /**<br />  * @param environment<br />  *            used to locate objects and services during the render<br />  * @param markupWriter<br />  */<br /> public AppValidationDecorator(Environment environment, MarkupWriter markupWriter) {<br />  this.environment = environment;<br />  this.markupWriter = markupWriter;<br /> }<br /><br /> @Override<br /> public void insideField(Field field) {<br />  if (inError(field))<br />   addErrorClassToCurrentElement();<br /> }<br /><br /> @Override<br /> public void insideLabel(Field field, Element element) {<br />  if (field == null)<br />   return;<br /><br />  if (inError(field))<br />   element.addClassName(CSSClassConstants.ERROR);<br /> }<br /><br /> private boolean inError(Field field) {<br />  ValidationTracker tracker = environment.peekRequired(ValidationTracker.class);<br /><br />  return tracker.inError(field);<br /> }<br /><br /> private void addErrorClassToCurrentElement() {<br />  markupWriter.getElement().addClassName(CSSClassConstants.ERROR);<br /> }<br />}</pre>
</div>
<br />Modificar el deccorador por defecto que usa Tapestry por defecto por el nuestro nos requerir&aacute; que modifiquemos la factor&iacute;a que se encarga de devolver los decoradores. 
<br />
<br />
<div>
 <pre>public class AppValidationDecoratorFactory implements ValidationDecoratorFactory {<br /> private final Environment environment;<br /><br /> public AppValidationDecoratorFactory(Environment environment) {<br />  this.environment = environment;<br /> }<br /><br /> public ValidationDecorator newInstance(MarkupWriter writer) {<br />  return new AppValidationDecorator(environment, writer);<br /> }<br />}</pre>
</div>
<br />Solo nos quedar&iacute;a hacer la contribuci&oacute;n al contenedor de dependencias para usar nuestra factor&iacute;a en vez la de por defecto. 
<br />
<br />
<div>
 <pre>// ...en la clase del m&oacute;dulo de la aplicaci&oacute;n<br /><br />public static void bind(ServiceBinder binder) {<br />    binder.bind(ValidationDecoratorFactory.class, AppValidationDecoratorFactory.class).withId(&quot;AppValidationDecoratorFactory&quot;);<br />}</pre>
</div>
<br />De esta forma podemos cambiar en todos los formularios de la aplicaci&oacute;n la forma en que se muestran los mensajes de error de una forma muy simple. Se puede apreciar que toda la l&oacute;gica de como se muestran los campos con error est&aacute; en una &uacute;nica clase.
<br />
<br />
<h4> Macros de validaciones</h4>Si nos encontramos en la situaci&oacute;n en que un determinado conjunto de validaciones se repite a lo lago de los campos de la aplicaci&oacute;n podemos definir una macro con ese conjunto de validaciones, como por ejemplo podr&iacute;a ser la validaci&oacute;n de un campo contrase&ntilde;a. 
<br />
<br />
<div>
 <pre>// ...en la clase del m&oacute;dulo de la aplicaci&oacute;n<br /><br />@Contribute(ValidatorMacro.class)<br />public static void contributeValidatorMacro(MappedConfiguration configuration) {<br />      configuration.add(&quot;password&quot;,&quot;required,minlength=5,maxlength=15&quot;);<br />}</pre>
</div>
<br />Ahora podemos usar el validador password, que comprende que el campo sea requerido, de una longitud m&iacute;nima de 5 caracteres y de 15 como m&aacute;ximo, como si fuera un validador m&aacute;s de forma declarativa: 
<br />
<br />
<div>
 <pre>&lt;input t:type=&quot;textField&quot; t:id=&quot;password&quot; t:validate=&quot;password&quot; /&gt;</pre>
</div>
<br />O mediante anotaciones: 
<br />
<br />
<div>
 <pre>@Validate(&quot;password&quot;)<br />private String password;</pre>
</div>
<br />Referencia:
<br />
<a href="http://tapestry.apache.org/forms-and-validation.html">http://tapestry.apache.org/forms-and-validation.html</a>
<br />
<a href="http://tapestry.apache.org/bean-validation.html">http://tapestry.apache.org/bean-validation.html</a>
<br />
<a href="http://elblogdepicodev.blogspot.com.es/2012/07/validaciones-de-datos-de-formularios.html">Validaciones de datos de formularios con Apache Tapestry</a>
<br />
<a href="http://elblogdepicodev.blogspot.com.es/2010/05/documentacion-sobre-apache-tapestry.html">Documentaci&oacute;n sobre Apache Tapestry</a></span></div><section><a id="share"></a><h1>Compartir</h1><div class="share-this"><span displayText="Tweet" class="st_twitter_vcount" st_url="http://www.blogstack.info/post/elblogdepicodev/2012/07/extender-las-validaciones-de-apache-tapestry" st_title="Extender las validaciones de Apache Tapestry | El blog de pico.dev"></span><span displayText="Facebook" class="st_facebook_vcount" st_url="http://www.blogstack.info/post/elblogdepicodev/2012/07/extender-las-validaciones-de-apache-tapestry" st_title="Extender las validaciones de Apache Tapestry | El blog de pico.dev"></span><span displayText="Google +" class="st_googleplus_vcount" st_url="http://www.blogstack.info/post/elblogdepicodev/2012/07/extender-las-validaciones-de-apache-tapestry" st_title="Extender las validaciones de Apache Tapestry | El blog de pico.dev"></span><span displayText="LinkedIn" class="st_linkedin_vcount" st_url="http://www.blogstack.info/post/elblogdepicodev/2012/07/extender-las-validaciones-de-apache-tapestry" st_title="Extender las validaciones de Apache Tapestry | El blog de pico.dev"></span><span displayText="Meneame" class="st_meneame_vcount" st_url="http://www.blogstack.info/post/elblogdepicodev/2012/07/extender-las-validaciones-de-apache-tapestry" st_title="Extender las validaciones de Apache Tapestry | El blog de pico.dev"></span></div><script src="http://w.sharethis.com/button/buttons.js" type="text/javascript"></script><script type="text/javascript">stLight.options({publisher: "ur-3b2014fd-82e-9968-7e00-5ee51fb88bb2", doNotHash: true, doNotCopy: true, hashAddressBar: false});</script><div id="widget"></div></section><section><a id="comments"></a><h1>Comentar</h1><div id="disqus_thread"></div><script type="text/javascript">
var disqus_shortname = "elblogdepicodev";
var disqus_title = "Extender las validaciones de Apache Tapestry";
var disqus_url = "http://elblogdepicodev.blogspot.com/2012/07/extender-las-validaciones-de-apache.html";
</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a class="dsq-brlink" href="http://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a></section><hr/></article></div><div class="col-xs-12 col-sm-12 col-md-4"><aside><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><section><h3>¡Suscríbete!</h3><ul class="list-unstyled"><li><a href="/label/programacion/feed.atom.xml"><span class="fa fa-rss"></span> Fuente de la etiqueta programacion</a></li><li><a href="/label/tapestry/feed.atom.xml"><span class="fa fa-rss"></span> Fuente de la etiqueta tapestry</a></li><li><a href="/label/java/feed.atom.xml"><span class="fa fa-rss"></span> Fuente de la etiqueta java</a></li></ul></section></div></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><div id="bigRectangle"></div></div></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><section><h3>Redes sociales</h3><p>¿Te gusta Blog Stack? ¡Compártelo!</p><div class="social-networks"><!-- Facebook --><div class="social-network"><div data-share="true" data-show-faces="false" data-action="like" data-width="310" data-layout="box_count" data-href="http://www.blogstack.info/" class="fb-like"></div></div><!-- Google+ --><div class="social-network"><div class="g-plusone" data-href="http://www.blogstack.info/" data-size="tall"></div></div></div></section></div></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><section id="lastPosts"></section></div></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><div id="bigSkycraper"></div></div></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><section id="lastPosts_0"></section></div></div></aside></div></div></div><footer><div class="container-fluid"><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><div class="footer"><a href="/">Blog Stack</a> por <a href="https://twitter.com/picodotdev/">pico.dev</a> está publicado bajo la licencia de software libre <a href="http://www.gnu.org/licenses/agpl-3.0.html">GNU Affero General Public</a> en <a href="https://github.com/picodotdev/blog-stack">GitHub <span class="entypo-social"></span></a>.<br/>
El contenido agregado conserva la licencia de su bitácora.<br/>
«Powered by» <a href="https://github.com/picodotdev/blogstack">Blog Stack</a>, <a href="http://tapestry.apache.org/">Apache Tapestry</a>, <a href="https://www.openshift.com/">OpenShift</a>, <a href="https://pages.github.com/">GitHub Pages</a>, <a href="http://www.oracle.com/es/technologies/java/overview/index.html">Java</a> y más software libre o de código abierto, inspirado en <a href="http://octopress.org/">Octopress</a>.<br/><span class="copyleft">©</span> pico.dev 2015
</div></div></div></div></footer><div id="fb-root"></div><script type="text/javascript">var require = {
  "waitSeconds" : 300,
  "shim" : {
    "t5/core/typeahead" : [
      "jquery"
    ],
    "bootstrap/affix" : [
      "bootstrap/transition"
    ],
    "bootstrap/alert" : [
      "bootstrap/transition"
    ],
    "bootstrap/modal" : [
      "bootstrap/transition"
    ],
    "bootstrap/tab" : [
      "bootstrap/transition"
    ],
    "bootstrap/transition" : [
      "jquery"
    ],
    "bootstrap/button" : [
      "bootstrap/transition"
    ],
    "bootstrap/scrollspy" : [
      "bootstrap/transition"
    ],
    "bootstrap/collapse" : [
      "bootstrap/transition"
    ],
    "bootstrap/dropdown" : [
      "bootstrap/transition"
    ],
    "bootstrap/tooltip" : [
      "bootstrap/transition"
    ],
    "bootstrap/carousel" : [
      "bootstrap/transition"
    ],
    "bootstrap/popover" : [
      "bootstrap/tooltip"
    ]
  },
  "baseUrl" : "/modules"
};
</script><script src="/assets/tapestry5/require.js" type="text/javascript"></script><script src="/assets/tapestry5/underscore-1.5.2.js" type="text/javascript"></script><script src="/assets/tapestry5/scriptaculous_1_9_0/prototype.js" type="text/javascript"></script><script src="/assets/tapestry5/scriptaculous_1_9_0/scriptaculous.js" type="text/javascript"></script><script src="/assets/tapestry5/scriptaculous_1_9_0/effects.js" type="text/javascript"></script><script src="/assets/tapestry5/t53-compatibility.js" type="text/javascript"></script><script src="/assets/tapestry5/jquery.js" type="text/javascript"></script><script src="/assets/tapestry5/jquery-noconflict.js" type="text/javascript"></script><script type="text/javascript">require(["t5/core/pageinit"], function(pi) { pi([], [
  "app/analytics",
  [
    "app/karmacracy:init",
    {
      "selector" : "#widget",
      "id" : 96,
      "url" : "http://www.blogstack.info/post/elblogdepicodev/2012/07/extender-las-validaciones-de-apache-tapestry"
    }
  ],
  "app/disqus",
  "app/facebook",
  "app/googleplus",
  [
    "app/lastPosts:init",
    {
      "id" : "lastPosts",
      "source" : "elblogdepicodev",
      "name" : "El blog de pico.dev"
    }
  ],
  [
    "app/lastPosts:init",
    {
      "id" : "lastPosts_0",
      "source" : "blogstack",
      "name" : "Blog Stack"
    }
  ],
  [
    "app/adsensem:init",
    {
      "blogstack" : {
        "adClient" : "ca-pub-3533636310991304",
        "adSlot" : "1397019380"
      },
      "ad" : {
        "adClient" : "ca-pub-3533636310991304",
        "adSlot" : "1397019380"
      }
    }
  ]
]); });</script></body></html>