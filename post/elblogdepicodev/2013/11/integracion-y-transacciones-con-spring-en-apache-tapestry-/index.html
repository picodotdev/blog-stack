<!DOCTYPE html><html data-debug-enabled="true" data-locale="es_ES" xmlns="http://www.w3.org/1999/xhtml"><head><meta content="Apache Tapestry Framework (version 5.4-beta-3)" name="generator"/><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><meta pagina="Post"/><title>Integración y transacciones con Spring en Apache Tapestry  | El blog de pico.dev</title><!-- Resources --><link type="text/css" rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:400,700"/><link type="text/css" rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css"/><link title="Portada" type="application/atom+xml" rel="alternate" href="/atom.xml"/><link type="image/png" rel="icon" href="/assets/images/favicon.png"/><meta content="Post" name="tapestry-page-name"/><link type="text/css" rel="stylesheet" href="/assets/tapestry5/bootstrap/css/bootstrap.css"/><link type="text/css" rel="stylesheet" href="/assets/tapestry5/tapestry.css"/><link type="text/css" rel="stylesheet" href="/assets/tapestry5/exception-frame.css"/><link type="text/css" rel="stylesheet" href="/assets/tapestry5/tapestry-console.css"/><link type="text/css" rel="stylesheet" href="/assets/tapestry5/tree.css"/><link type="text/css" rel="stylesheet" href="/assets/css/core.css"/></head><body data-page-initialized="false"><header><div class="container-fluid"><div class="row"><div class="col-xs-12 col-sm-12 col-md-4"><h1><a class="blogstack" href="/"><span class="glyphicon glyphicon-th"></span> Blog <span class="stack">Stack</span></a></h1></div><div class="col-xs-12 col-sm-12 col-md-8" id="horizontalSkycraper"></div></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><h4>Un poco más que un agregador/planeta de bitácoras sobre programación, desarrollo, software libre, gnu/linux, tecnología, ...</h4></div></div></div></header><div class="container-fluid"><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><nav role="navigation"><ul class="nav nav-pills menu"><li><a href="/">Inicio</a></li><li><a href="/faq">Preguntas frecuentes</a></li></ul></nav></div></div></div><div class="container-fluid"><div class="row"><div class="col-xs-12 col-sm-12 col-md-8 content"><article><header><h2><a href="/post/elblogdepicodev/2013/11/integracion-y-transacciones-con-spring-en-apache-tapestry-">Integración y transacciones con Spring en Apache Tapestry </a></h2></header><section class="post-data"><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><div><span>Bitácora <a href="http://elblogdepicodev.blogspot.com.es/">El blog de pico.dev</a></span>, <span>Autor pico.dev</span>, <span><a href="http://elblogdepicodev.blogspot.com/2013/11/integracion-y-transacciones-con-spring.html">Entrada original</a></span></div><div><span>Publicado el viernes, 08 de noviembre de 2013 a las 20:04 UTC</span></div><div><span>Actualizado el domingo, 10 de noviembre de 2013 a las 11:41 UTC</span></div><div><span>
Etiquetado como
<a href="/label/planeta-codigo">planeta-codigo</a>
,
<a href="/label/programacion">programacion</a>
,
<a href="/label/software">software</a>
,
<a href="/label/tapestry">tapestry</a>
,
<a href="/label/java">java</a></span></div></div></div></section><div class="text-justify post-content"><div class="share-this only-twitter"><span displayText="Tweet" class="st_twitter_vcount" st_url="http://www.blogstack.info/post/elblogdepicodev/2013/11/integracion-y-transacciones-con-spring-en-apache-tapestry-" st_via="blogstack" st_title="Integración y transacciones con Spring en Apache Tapestry  | El blog de pico.dev"></span></div><script src="http://w.sharethis.com/button/buttons.js" type="text/javascript"></script><script type="text/javascript">stLight.options({publisher: "ur-3b2014fd-82e-9968-7e00-5ee51fb88bb2", doNotHash: true, doNotCopy: true, hashAddressBar: false});</script><div style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;">
 <img alt="Apache Tapestry" height="133" src="http://4.bp.blogspot.com/-OGvCbjBk0zU/TOq7Y6w6wfI/AAAAAAAAAiU/Pfuzt5kkDBQ/s320/tapestry.png" title="Apache Tapestry" width="320" />
</div>
<div style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;">
 <img alt="Spring" src="http://1.bp.blogspot.com/-z3Uf7rZosVk/Un04HYeUy3I/AAAAAAAACq0/JxaGVTEux-E/s1600/spring.png" title="Spring" />
</div>En otra entrada comentaba como hacer transacciones en una base de datos relacional con Apache Tapestry y como mejorar el soporte que ofrece de por si con la anotaci&oacute;n CommitAfter mediante con una 
<a href="http://elblogdepicodev.blogspot.com.es/2013/11/transacciones-en-apache-tapestry.html">soluci&oacute;n propia que proporciona la anotaci&oacute;n Transactional</a>. La soluci&oacute;n propia mejora la anotaci&oacute;n CommitAfter y es usable en m&aacute;s casos como cuando dos servicios distintos necesitan colaborar en una transaccion y compartirla. Sin embargo, si el correcto funcionamiento de las transacciones es una parte importante de la aplicaci&oacute;n (y en una aplicaci&oacute;n grande lo ser&aacute;) podemos evaluar si optar por Spring o los EJB en vez de la soluci&oacute;n propia o la anotaci&oacute;n CommitAfter.
<br />
<br />Unos buenos motivos para optar tanto por Spring como por los EJB es que son soluciones ya desarrolladas con lo que solo tendremos que integrarlo en nuestros proyectos y no tendremos que preocuparnos de mantener nuestra soluci&oacute;n en caso de que tenga errores, adem&aacute;s ambas son ampliamente usadas incluso en proyectos grandes y complejos y est&aacute;n ya probadas lo que es una garant&iacute;a. Entre optar por Spring o los EJB depende de varios factores como puede ser si la aplicaci&oacute;n va ha ser desplegada en un servidor de aplicaciones con soporte para EJB (como 
<a href="http://www.jboss.org/jbossas">JBoss</a>/
<a href="http://wildfly.org/">Wildfly</a>, 
<a href="http://geronimo.apache.org/">Geronimo</a>, ...) o no (
<a href="http://tomcat.apache.org/">Tomcat</a>, 
<a href="http://www.eclipse.org/jetty/">Jetty</a>) o de nuestras preferencias entre ambas opciones. En esta entrada explicar&eacute; como integrar 
<a href="http://spring.io/">Spring</a> con el framework 
<a href="http://tapestry.apache.org/">Apache Tapestry</a> y como hacer uso de las transacciones de Spring en los servicios que contienen la l&oacute;gica de la aplicaci&oacute;n.
<br />
<br />Primeramente, decir que en cierta medida la funcionalidad proporcionada por el contenedor de dependencias de Tapestry y el contenedor de dependencias de Spring se solapan, ambos proporcionan 
<a href="http://en.wikipedia.org/wiki/Inversion_of_control">Inversion of Control</a> (IoC). Pero el contenedor de dependencias de Tapestry tiene algunas ventajas como permitir configuraci&oacute;n distribuida, esto hace referencia a que cada librer&iacute;a jar puede contribuir con su configuraci&oacute;n al contenedor de dependencias y que la configuraci&oacute;n se hace mediante c&oacute;digo Java en vez de xml como en Spring con la ventaja de que es m&aacute;s r&aacute;pido, tenemos la ayuda del compilador para detectar errores y el lenguaje Java es m&aacute;s adecuado para expresar la construcci&oacute;n de objetos. De modo que si podemos es mejor usar el contenedor de Tapestry que el de Spring, sin embargo, Spring ofrece un mont&oacute;n de funcionalidades muy &uacute;tiles y esto nos puede obligar a usar el contenedor de Spring para ciertos objetos. Una de ellas son las transacciones para cumplir con las reglas ACID de las bases de datos relacionales, para ello deberemos definir en el contenedor de Spring (y no en el de Tapestry) los servicios con la l&oacute;gica de negocio con necesidades transaccionales y las dependencias referidas por esos servicios en la configuraci&oacute;n del contexto de Spring. A pesar de todo en los dem&aacute;s casos podemos optar por la opci&oacute;n que prefiramos ya que tanto a los servicios de Spring se les pueden inyectar dependencias del contenedor de Tapestry y, el caso contrario, a los servicios de Tapestry se les pueden inyectar servicios de Spring.
<br />
<br />Veamos en c&oacute;digo un ejemplo de como conseguir integraci&oacute;n entre Tapestry y Spring. La primera cosa que cambia es que hay que usar un filtro de Tapestry especial para integrarse con Spring con lo que deberemos modificarlo en el archivo web.xml. Si normalmente usamos el filtro org.apache.tapestry5.TapestryFilter para que Tapestry procese las peticiones que llegan a la aplicaci&oacute;n, integr&aacute;ndonos con Spring usaremos un filtro especial, org.apache.tapestry5.spring.TapestrySpringFilter. Tambi&eacute;n mediante una propiedad de contexto indicaremos el (o los) xml con la definici&oacute;n de los beans de Spring.
<br />
<br />
<script src="https://gist.github.com/picodotdev/7376394.js?file=web.xml"></script>
<noscript>
 <a href="https://gist.github.com/picodotdev/7376394/raw/web.xml">web.xml</a>
 <br />
</noscript> En el xml del contexto para Spring definimos la configuraci&oacute;n para que Hibernate se conecte a la base de datos, definimos el SesionFactory que crear&aacute; la sesiones de Hibernate, el gestor de transacciones y los servicios con la l&oacute;gica de negocio. En este ejemplo he optado por definir las transacciones mediante anotaciones en los servicios con la l&oacute;gica de negocio. Spring tambi&eacute;n permite definir la transaccionalidad de forma declarativa en este xml.
<br />
<br />
<script src="https://gist.github.com/picodotdev/7376394.js?file=applicationContext.xml"></script>
<noscript>
 <a href="https://gist.github.com/picodotdev/7376394/raw/applicationContext.xml">applicationContext.xml</a>
 <br />
</noscript> Como Spring se encargar&aacute; de la configuraci&oacute;n de Hibernate si incluimos la dependencia tapestry-hibernate tendremos un problema ya que este m&oacute;dulo de Tapestry tambi&eacute;n intenta inicializar Hibernate. Para evitarlo y disponer de toda la funcionalidad que ofrece este m&oacute;dulo como encoders para las entidades de dominio, la p&aacute;gina de estad&iacute;sticas de Hibernate o el objeto Session como un servicio inyectable en p&aacute;ginas o componentes hay que redefinir el servicio HibernateSessionSource. El nuevo servicio es muy sencillo, b&aacute;sicamente obtiene el la configuraci&oacute;n de Hibernate mediante el bean SessionFactory definido en Spring y adem&aacute;s mediante el mismo bean se crea el objeto Session que podr&aacute; inyectarse en los componentes y p&aacute;ginas de Tapestry en los que lo necesitemos. Tambi&eacute;n deberemos a&ntilde;adir un poco de configuraci&oacute;n en el m&oacute;dulo de la aplicaci&oacute;n para redefinir este servicio.
<br />
<br />
<script src="https://gist.github.com/picodotdev/7376394.js?file=HibernateSessionSourceImpl.java"></script>
<noscript>
 <a href="https://gist.github.com/picodotdev/7376394/raw/HibernateSessionSourceImpl.java">HibernateSessionSourceImpl.java</a>
 <br />
</noscript>
<script src="https://gist.github.com/picodotdev/7376394.js?file=AppModule.java"></script>
<noscript>
 <a href="https://gist.github.com/picodotdev/7376394/raw/AppModule.java">AppModule.java</a>
 <br />
</noscript> Para definir la transaccionalidad de una operaci&oacute;n debemos usar la anotaci&oacute;n Transactional usando los valores por defecto o indicando la propagaci&oacute;n, el aislamiento, si es de solo lecura, timeout, etc, ... seg&uacute;n consideremos. Debido a lo simple de la l&oacute;gica de negocio de la aplicaci&oacute;n de este ejemplo la anotaci&oacute;n se aplica al DAO, sin embargo, en una aplicaci&oacute;n m&aacute;s compleja y con mas clases ser&iacute;a mejor definirlo a nivel de servicio de l&oacute;gica de negocio o punto de entrada a la l&oacute;gica de negocio y no al nivel de los DAO que est&aacute;n en una capa de la aplicaci&oacute;n m&aacute;s baja.
<br />
<br />
<script src="https://gist.github.com/picodotdev/7376394.js?file=GenericDAO.java"></script>
<noscript>
 <a href="https://gist.github.com/picodotdev/7376394/raw/GenericDAO.java">GenericDAO.java</a>
 <br />
</noscript>
<script src="https://gist.github.com/picodotdev/7376394.js?file=GenericDAOImpl.java"></script>
<noscript>
 <a href="https://gist.github.com/picodotdev/7376394/raw/GenericDAOImpl.java">GenericDAOImpl.java</a>
 <br />
</noscript> Finalmente, debemos a&ntilde;adir o modificar las dependencias de nuestra aplicaci&oacute;n. La dependencia tapestry-spring usa por defecto la versi&oacute;n 3.1.0 de Spring, en el ejemplo la sustituyo por la versi&oacute;n 3.2.4 m&aacute;s reciente. A continuaci&oacute;n incluyo la parte relevante.
<br />
<br />
<script src="https://gist.github.com/picodotdev/7376394.js?file=build.gradle"></script>
<noscript>
 <a href="https://gist.github.com/picodotdev/7376394/raw/build.gradle">build.gradle</a>
 <br />
</noscript> Si te ha parecido interesante esta entrada puedes descargar el 
<a href="http://elblogdepicodev.blogspot.com.es/2013/07/libro-sobre-desarrollo-de-aplicaciones.html">libro PlugIn Tapestry</a> en el que explico m&aacute;s en detalle como desarrollar aplicaciones web en Tapestry y en el que descubrir&aacute;s como resolver problemas comunes en las aplicaciones web de una forma tan buena como esta.
<br />
<br />Si quieres probarlo en tu equipo lo puedes hacer de forma muy sencilla con los siguientes comandos y sin instalar nada. Si no dispones de git para clonar 
<a href="https://github.com/picodotdev/elblogdepicodev/tree/master/PlugInTapestry">mi repositorio de GitHub</a> puedes obtener el 
<a href="https://github.com/picodotdev/elblogdepicodev/archive/master.zip">c&oacute;digo fuente del repositorio en un archivo zip</a>.
<br />
<br />
<script src="https://gist.github.com/picodotdev/7376394.js?file=git.sh"></script>
<noscript>
 <a href="https://gist.github.com/picodotdev/7376394/raw/git.sh">git.sh</a>
 <br />
</noscript> Referencia:
<br />
<a href="http://elblogdepicodev.blogspot.com.es/2013/11/transacciones-en-apache-tapestry.html">Transacciones en Apache Tapestry</a> 
<br />
<a href="http://elblogdepicodev.blogspot.com.es/2013/06/persistencia-con-jpa-y-apache-tapestry.html">Persistencia con JPA y Apache Tapestry</a>
<br />
<a href="http://elblogdepicodev.blogspot.com.es/2013/08/acceso-base-de-datos-con-hibernate-y-jpa.html">Acceso a base de datos con Hibernate y JPA</a>
<br />
<a href="http://docs.spring.io/spring/docs/3.0.x/reference/transaction.html">Transaction Management (Spring)</a></div><section><h1>Compartir</h1><div class="share-this"><span displayText="Tweet" class="st_twitter_vcount" st_url="http://www.blogstack.info/post/elblogdepicodev/2013/11/integracion-y-transacciones-con-spring-en-apache-tapestry-" st_via="blogstack" st_title="Integración y transacciones con Spring en Apache Tapestry  | El blog de pico.dev"></span><span displayText="Facebook" class="st_facebook_vcount" st_url="http://www.blogstack.info/post/elblogdepicodev/2013/11/integracion-y-transacciones-con-spring-en-apache-tapestry-" st_title="Integración y transacciones con Spring en Apache Tapestry  | El blog de pico.dev"></span><span displayText="Google +" class="st_googleplus_vcount" st_url="http://www.blogstack.info/post/elblogdepicodev/2013/11/integracion-y-transacciones-con-spring-en-apache-tapestry-" st_title="Integración y transacciones con Spring en Apache Tapestry  | El blog de pico.dev"></span><span displayText="LinkedIn" class="st_linkedin_vcount" st_url="http://www.blogstack.info/post/elblogdepicodev/2013/11/integracion-y-transacciones-con-spring-en-apache-tapestry-" st_title="Integración y transacciones con Spring en Apache Tapestry  | El blog de pico.dev"></span><span displayText="Meneame" class="st_meneame_vcount" st_url="http://www.blogstack.info/post/elblogdepicodev/2013/11/integracion-y-transacciones-con-spring-en-apache-tapestry-" st_title="Integración y transacciones con Spring en Apache Tapestry  | El blog de pico.dev"></span></div><script src="http://w.sharethis.com/button/buttons.js" type="text/javascript"></script><script type="text/javascript">stLight.options({publisher: "ur-3b2014fd-82e-9968-7e00-5ee51fb88bb2", doNotHash: true, doNotCopy: true, hashAddressBar: false});</script><div id="widget"></div></section><section><h1>Comentar</h1><div id="disqus_thread"></div><script type="text/javascript">
var disqus_shortname = "elblogdepicodev";
var disqus_title = "Integración y transacciones con Spring en Apache Tapestry ";
var disqus_url = "http://elblogdepicodev.blogspot.com/2013/11/integracion-y-transacciones-con-spring.html";
</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a class="dsq-brlink" href="http://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a></section><hr/></article></div><aside class="col-xs-12 col-sm-12 col-md-4"><section><h3>Redes sociales</h3><p>¿Te gusta Blog Stack? ¡Compártelo con tus amigos!</p><div class="social-networks"><!-- Facebook --><div data-share="true" data-show-faces="false" data-action="like" data-width="310" data-layout="standard" data-href="http://www.blogstack.info/" class="fb-like"></div><!-- Google+ --><g:plusone size="standard" annotation="inline" href="http://www.blogstack.info/" width="310"></g:plusone></div></section><section><h3>¡Suscríbete!</h3><ul class="list-unstyled"><li><a href="/label/planeta-codigo/feed.atom.xml"><span class="fa fa-rss"></span> Fuente de la etiqueta planeta-codigo</a></li><li><a href="/label/programacion/feed.atom.xml"><span class="fa fa-rss"></span> Fuente de la etiqueta programacion</a></li><li><a href="/label/software/feed.atom.xml"><span class="fa fa-rss"></span> Fuente de la etiqueta software</a></li><li><a href="/label/tapestry/feed.atom.xml"><span class="fa fa-rss"></span> Fuente de la etiqueta tapestry</a></li><li><a href="/label/java/feed.atom.xml"><span class="fa fa-rss"></span> Fuente de la etiqueta java</a></li></ul></section><div id="bigRectangle"></div><section id="lastPosts"></section><div class="row"><div class="col-xs-3 col-md-2"><div id="wideSkycraper"></div></div></div><section id="lastPosts_0"></section></aside></div></div><footer><div class="container-fluid"><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><div class="footer"><a href="/">Blog Stack</a> por <a href="https://twitter.com/picodotdev/">pico.dev</a> está publicado bajo la licencia <a href="http://www.gnu.org/licenses/agpl-3.0.html">GNU Affero General Public</a>.<br/>
El contenido agregado conserva la licencia de su bitácora.<br/>
«Powered by» <a href="https://github.com/picodotdev/blogstack">Blog Stack</a>, <a href="http://tapestry.apache.org/">Apache Tapestry</a>, <a href="https://www.openshift.com/">OpenShift</a>, <a href="https://pages.github.com/">GitHub Pages</a>, <a href="http://www.oracle.com/es/technologies/java/overview/index.html">Java</a> y más software libre o de código abierto, inspirado en <a href="http://octopress.org/">Octopress</a>.<br/><span class="copyleft">©</span> pico.dev 2014
</div></div></div></div></footer><div id="fb-root"></div><script type="text/javascript">var require = {
  "waitSeconds" : 300,
  "shim" : {
    "t5/core/typeahead" : [
      "jquery"
    ],
    "bootstrap/affix" : [
      "bootstrap/transition"
    ],
    "bootstrap/alert" : [
      "bootstrap/transition"
    ],
    "bootstrap/modal" : [
      "bootstrap/transition"
    ],
    "bootstrap/tab" : [
      "bootstrap/transition"
    ],
    "bootstrap/transition" : [
      "jquery"
    ],
    "bootstrap/button" : [
      "bootstrap/transition"
    ],
    "bootstrap/scrollspy" : [
      "bootstrap/transition"
    ],
    "bootstrap/collapse" : [
      "bootstrap/transition"
    ],
    "bootstrap/dropdown" : [
      "bootstrap/transition"
    ],
    "bootstrap/tooltip" : [
      "bootstrap/transition"
    ],
    "bootstrap/carousel" : [
      "bootstrap/transition"
    ],
    "bootstrap/popover" : [
      "bootstrap/tooltip"
    ]
  },
  "baseUrl" : "/modules"
};
</script><script src="/assets/tapestry5/require.js" type="text/javascript"></script><script src="/assets/tapestry5/underscore-1.5.2.js" type="text/javascript"></script><script src="/assets/tapestry5/scriptaculous_1_9_0/prototype.js" type="text/javascript"></script><script src="/assets/tapestry5/scriptaculous_1_9_0/scriptaculous.js" type="text/javascript"></script><script src="/assets/tapestry5/scriptaculous_1_9_0/effects.js" type="text/javascript"></script><script src="/assets/tapestry5/t53-compatibility.js" type="text/javascript"></script><script src="/assets/tapestry5/jquery.js" type="text/javascript"></script><script src="/assets/tapestry5/jquery-noconflict.js" type="text/javascript"></script><script type="text/javascript">require(["t5/core/pageinit"], function(pi) { pi([], [
  "app/analytics",
  [
    "app/karmacracy:init",
    {
      "selector" : "#widget",
      "id" : 6,
      "url" : "http://www.blogstack.info/post/elblogdepicodev/2013/11/integracion-y-transacciones-con-spring-en-apache-tapestry-"
    }
  ],
  "app/disqus",
  "app/facebook",
  "app/googleplus",
  [
    "app/lastPosts:init",
    {
      "id" : "lastPosts",
      "source" : "elblogdepicodev",
      "name" : "El blog de pico.dev"
    }
  ],
  [
    "app/lastPosts:init",
    {
      "id" : "lastPosts_0",
      "source" : "blogstack",
      "name" : "Blog Stack"
    }
  ],
  [
    "app/adsensem:init",
    {
      "blogstack" : {
        "adClient" : "ca-pub-3533636310991304",
        "adSlotHorizontalSkycraper" : "1397019380",
        "adSlotBigRectangle" : "2873752587",
        "adSlotWideSkycraper" : "1896546988"
      }
    }
  ]
]); });</script></body></html>