<!DOCTYPE html><html data-debug-enabled="true" data-locale="es_ES" xmlns="http://www.w3.org/1999/xhtml"><head><meta content="Apache Tapestry Framework (version 5.4-beta-16)" name="generator"/><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><meta pagina="Post"/><title>Usar Apache Tapestry en una aplicación «standalone» | Blog Bitix</title><!-- Resources --><link type="text/css" rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:400,700"/><link type="text/css" rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css"/><link title="Portada" type="application/atom+xml" rel="alternate" href="/feed.atom.xml"/><link type="image/png" rel="icon" href="/assets/images/favicon.png"/><meta content="Post" name="tapestry-page-name"/><link type="text/css" rel="stylesheet" href="/assets/tapestry5/bootstrap/css/bootstrap.css"/><link type="text/css" rel="stylesheet" href="/assets/tapestry5/tapestry.css"/><link type="text/css" rel="stylesheet" href="/assets/tapestry5/exception-frame.css"/><link type="text/css" rel="stylesheet" href="/assets/tapestry5/tapestry-console.css"/><link type="text/css" rel="stylesheet" href="/assets/tapestry5/tree.css"/><link type="text/css" rel="stylesheet" href="/assets/css/core.css"/></head><body data-page-initialized="false"><script type="text/javascript">document.write("<div class=\"pageloading-mask\"><div></div></div>");</script><header><div class="container-fluid"><div class="row"><div class="col-xs-12 col-sm-12 col-md-4"><h1><a class="blogstack" href="/"><span class="glyphicon glyphicon-th"></span> Blog <span class="stack">Stack</span></a></h1></div><div class="col-xs-12 col-sm-12 col-md-6"><nav role="navigation"><ul class="list-unstyled list-inline"><li><a class="header" href="/">Inicio</a></li><li><a class="header" href="/archive">Archivo</a></li><li><a class="header" href="/faq">Preguntas frecuentes</a></li><li><a class="header" href="/faq#aggregate">¿Quieres agregar tu bitácora?</a></li></ul></nav></div><div class="col-xs-6 col-sm-6 col-md-2"><a title="Fuente RSS, ¡suscríbete a BS!" alt="Fuente RSS" class="header" href="/feed.atom.xml"><span class="header icon entypo"></span></a><a title="Twitter, ¡sigue a BS!" alt="Twitter" class="header" href="http://twitter.com/blogstackinfo"><span class="header icon entypo-social"></span></a></div></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><h4>Un poco más que un agregador/planeta de bitácoras sobre programación, desarrollo, software libre, gnu/linux, tecnología, ...</h4></div></div></div><div class="container-fluid"><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><div class="imagen-cabecera"><div class="imagen"><div class="col-xs-12 col-sm-12 col-md-12" id="billboard"></div></div></div></div></div></div></header><div class="container-fluid content"><div class="row"><div class="col-xs-12 col-sm-12 col-md-8 content"><article itemtype="http://schema.org/BlogPosting" itemscope=""><a id="content"></a><header><h2><a href="/post/blogbitix/2014/07/usar-apache-tapestry-en-una-aplicacion-standalone"><span itemprop="headline">Usar Apache Tapestry en una aplicación «standalone»</span></a></h2></header><div class="row labels"><div class="col-md-12"><a class="label" href="/label/programacion"><img title="programacion" alt="programacion" src="/assets/images/labels/programacion.png"/></a><a class="label" href="/label/java"><img title="java" alt="java" src="/assets/images/labels/java.png"/></a><a class="label" href="/label/software"><img title="software" alt="software" src="/assets/images/labels/software.png"/></a><a class="label" href="/label/tapestry"><img title="tapestry" alt="tapestry" src="/assets/images/labels/tapestry.png"/></a></div></div><section class="post-data"><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><div><span>Escrito por <span itemprop="author">pico.dev</span> en la bitácora <a href="http://picodotdev.github.io/blog-bitix/">Blog Bitix</a>, <a href="http://picodotdev.github.io/blog-bitix/2014/07/usar-apache-tapestry-en-una-aplicacion-standalone/"><span itemprop="sameAs">artículo original</span></a></span></div><div><span datetime="2014-07-31T11:06" itemprop="datePublished">Publicado el jueves, 31 de julio de 2014 a las 11:06 UTC</span></div><div><span>
Etiquetado como
blog-stack, <a href="/label/programacion"><span itemprop="articleSection">programacion</span></a>, <a href="/label/java"><span itemprop="articleSection">java</span></a>, planeta-codigo, <a href="/label/software"><span itemprop="articleSection">software</span></a>, <a href="/label/tapestry"><span itemprop="articleSection">tapestry</span></a></span></div></div></div></section><div class="text-justify post-content"><div class="share-this only-twitter"><span displayText="Tweet" class="st_twitter_vcount" st_url="http://www.blogstack.info/post/blogbitix/2014/07/usar-apache-tapestry-en-una-aplicacion-standalone" st_title="Usar Apache Tapestry en una aplicación «standalone» | Blog Bitix"></span></div><script src="http://w.sharethis.com/button/buttons.js" type="text/javascript"></script><script type="text/javascript">stLight.options({publisher: "ur-3b2014fd-82e-9968-7e00-5ee51fb88bb2", doNotHash: true, doNotCopy: true, hashAddressBar: false});</script><span itemprop="name"><div style="float: right; text-align: right;"> 
 <img src="http://picodotdev.github.io/blog-bitix/images/custom/logotipos/tapestry.png" alt="Apache Tapestry" title="Apache Tapestry" />
 <br /> 
</div> 
<p><a href="http://tapestry.apache.org">Apache Tapestry</a> es un framework de desarrollo para aplicaciones o p&aacute;ginas web en el que habitualmente se emplea el lenguaje Java y se despliega en un servidor de aplicaciones como entorno de ejecuci&oacute;n. Pero Tapestry es una pieza de software que se compone de diferentes partes algunas de las cuales pueden ser utilizadas fuera del contexto de una aplicaci&oacute;n web. Este es el caso del contenedor de dependencias que proporciona <a href="http://en.wikipedia.org/wiki/Inversion_of_control">IoC</a> (IoC, &laquo;Inversion of Control&raquo;) en Tapestry, podemos usarlo en una aplicaci&oacute;n &laquo;standalone&raquo;, es decir, en un programa que se inicia con el t&iacute;pico &laquo;public static void main(String[] args)&raquo; de las aplicaciones Java.</p> 
<p>El contenedor de dependencias de Tapestry tiene algunas propiedades interesantes como que dos servicios pueden ser mutuamente dependientes y que se puede contribuir configuraci&oacute;n a cualquier servicio para cambiar en cierta medida su comportamiento adem&aacute;s de otras caracter&iacute;sticas que explico m&aacute;s en detalle en el libro <a href="http://picodotdev.github.io/blog-bitix/2014/02/libro-sobre-desarrollo-de-aplicaciones-con-apache-tapestry/">PlugIn Tapestry</a>. Para usarlo en una un programa que se ejecuta de la linea de comandos usando el main de una clase Java primeramente deberemos incluir en el proyecto la dependencia sobre tapestry-ioc, si usamos <a href="http://gradle.org/">Gradle</a> de la siguiente manera:</p> 
<p></p>
<div>
 <script src="https://gist.github.com/picodotdev/8371b84c3186540a2f7f.js?file=build-1.gradle"></script> 
 <noscript>
  <pre><code>compile 'org.apache.tapestry:tapestry-core:5.4-beta-3'
compile 'org.apache.tapestry:tapestry-ioc5.4-beta-3'</code></pre>
 </noscript>
</div> 
<p></p> 
<p>Una vez que tenemos la dependencia en el programa deberemos iniciar el contenedor IoC e indicarle los diferentes m&oacute;dulos que contendr&aacute;n la definici&oacute;n de los servicios.</p> 
<p></p>
<div>
 <script src="https://gist.github.com/picodotdev/8371b84c3186540a2f7f.js?file=Main-1.java"></script> 
 <noscript>
  <pre><code>RegistryBuilder builder = new RegistryBuilder();
builder.add(TapestryModule.class, HibernateCoreModule.class, HibernateModule.class, BeanValidatorModule.class, TapestryOfflineModule.class, GeneratorModule.class);
builder.add(new SpringModuleDef(&quot;applicationContext.xml&quot;));

Registry registry = builder.build();
registry.performRegistryStartup();</code></pre>
 </noscript>
</div> 
<p></p> 
<p>En este caso he usado <a href="http://elblogdepicodev.blogspot.com.es/2013/11/integracion-y-transacciones-con-spring.html">Spring para la transacionalidad</a> e Hibernate para la persistencia. Despu&eacute;s de esto tenemos la referencia al registro de servicios, podemos obtener cualquiera en base a la interfaz que implementa, en este caso el servicio que implementa la interfaz <a href="https://github.com/picodotdev/blog-stack/blob/master/src/main/java/info/blogstack/services/MainService.java">MainService</a>.</p> 
<p></p>
<div>
 <script src="https://gist.github.com/picodotdev/8371b84c3186540a2f7f.js?file=Main-2.java"></script> 
 <noscript>
  <pre><code>registry.getService(MainService.class);</code></pre>
 </noscript>
</div> 
<p></p> 
<p>Al final de la aplicaci&oacute;n deberemos llamar al m&eacute;todo shutdown del registro.</p> 
<p></p>
<div>
 <script src="https://gist.github.com/picodotdev/8371b84c3186540a2f7f.js?file=Main-3.java"></script> 
 <noscript>
  <pre><code>registry.shutdown();</code></pre>
 </noscript>
</div> 
<p></p> 
<p>Otra cosa que nos puede interesar es poder generar contenido html usando el sistema de plantillas y componentes de Tapestry, ya sea en una aplicaci&oacute;n &laquo;standalone&raquo; o en una aplicaci&oacute;n web para enviar el contenido en un correo electr&oacute;nico o quiz&aacute; guardarlo en un archivo. Hay muchos sistemas de plantillas, cada framework suele tener uno propio o usar una soluci&oacute;n espec&iacute;fica como <a href="http://www.thymeleaf.org/">Thymeleaf</a> pero la mayor&iacute;a usa un <a href="http://picodotdev.github.io/blog-bitix/2014/07/modelo-push-contra-modelo-pull-en-frameworks-web/">modelo push en vez de un modelo pull</a>, en el caso de Tapestry se emplea el modelo pull que tiene algunas ventajas como explico en el art&iacute;culo anterior. Si usamos una aplicaci&oacute;n Tapestry us&aacute;ndolo tambi&eacute;n para generar el contenido de los correos o cierto contenido est&aacute;tico evitamos tener que aprender una segunda tecnolog&iacute;a adem&aacute;s de aprovechar todo el c&oacute;digo reutilizable que posiblemente hemos desarrollado en algunos componentes. Para generar el contenido est&aacute;tico que generar&iacute;a una p&aacute;gina en Tapestry tenemos el m&oacute;dulo <a href="https://github.com/uklance/tapestry-offline">Tapestry Offline</a>. Como no est&aacute; en los repositorio de maven debemos descargarnos el jar e incluir la dependencia como un archivo.</p> 
<p></p>
<div>
 <script src="https://gist.github.com/picodotdev/8371b84c3186540a2f7f.js?file=build-2.gradle"></script> 
 <noscript>
  <pre><code>compile files('misc/libs/tapestry-offline.jar')</code></pre>
 </noscript>
</div> 
<p></p> 
<p>Para generar una p&aacute;gina de Tapestry fuera de una petici&oacute;n web y de un servidor de aplicaciones debemos usar el servicio OfflineComponentRenderer. Su uso ser&iacute;a el siguiente:</p> 
<p></p>
<div>
 <script src="https://gist.github.com/picodotdev/8371b84c3186540a2f7f.js?file=GeneratorServiceImpl.java"></script> 
 <noscript>
  <pre><code>@Override
public File generatePage(String page, Object[] context, Map&lt;String, String&gt; params) throws IOException {
	File file = new File(to, getToPage(page, context, params).getPath());
	logger.info(&quot;Generating page &laquo;{}&raquo; ({}, {})...&quot;, page, file, params.toString());

	file.getParentFile().mkdirs();

	Writer w = new FileWriter(file);
	render(page, context, params, Globals.LOCALE, w);
	w.close();

	return file;
}

private void render(String page, Object[] context, Map&lt;String, String&gt; params, Locale locale, Writer writer) throws IOException {
	TypeCoercer coercer = Globals.registry.getService(TypeCoercer.class);
	OfflineComponentRenderer renderer = Globals.registry.getService(&quot;BlogStackOfflineComponentRenderer&quot;, OfflineComponentRenderer.class);

	EventContext activationContext = new ArrayEventContext(coercer, context);
	PageRenderRequestParameters requestParams = new PageRenderRequestParameters(page, activationContext, false);
	DefaultOfflineRequestContext requestContext = new DefaultOfflineRequestContext();
	for (Map.Entry&lt;String, String&gt; param : params.entrySet()) {
		requestContext.setParameter(param.getKey(), param.getValue());
	}
	requestContext.setLocale(locale);

	renderer.renderPage(writer, requestContext, requestParams);
}</code></pre>
 </noscript>
</div> 
<p></p> 
<p>Tengo que decir que al generar la p&aacute;gina fuera de una petici&oacute;n web tendremos alguna limitaci&oacute;n como solo poder usar assets con el prefijo context. Pero esto por lo menos <a href="http://picodotdev.github.io/blog-bitix/2014/05/arquitectura-y-hospedaje-de-blog-stack/">como he explicado en el caso de Blog Stack</a> no me ha supuesto ning&uacute;n problema.</p> 
<p>Esto quiz&aacute; no sea lo habitual pero en <a href="http://blogstack.info/">Blog Stack</a> ambas posibilidades me han resultado de gran utilidad al desarrollar el proyecto. Las posibilidades son muchas por ejemplo podr&iacute;amos usar alguna combinaci&oacute;n de esto mismo con el microframework <a href="http://blogstack.info/">Spark</a> si nuestra aplicaci&oacute;n estuviese m&aacute;s orientada a una API aunque tambi&eacute;n podr&iacute;amos <a href="http://elblogdepicodev.blogspot.com.es/2013/03/integracion-tapestry-con-resteasy.htm.html">usarlo junto con RESTEasy</a>.</p> 
<p>Referencia:<br /> <a href="http://picodotdev.github.io/blog-bitix/2014/02/libro-sobre-desarrollo-de-aplicaciones-con-apache-tapestry/">Libro PlugIn Tapestry</a><br /> <a href="http://elblogdepicodev.blogspot.com.es/2010/05/documentacion-sobre-apache-tapestry.html">Documentaci&oacute;n sobre Apache Tapestry</a>[ansible]: <a href="http://www.ansible.com">http://www.ansible.com</a></p></span></div><section><a id="share"></a><h1>Compartir</h1><div class="share-this"><span displayText="Tweet" class="st_twitter_vcount" st_url="http://www.blogstack.info/post/blogbitix/2014/07/usar-apache-tapestry-en-una-aplicacion-standalone" st_title="Usar Apache Tapestry en una aplicación «standalone» | Blog Bitix"></span><span displayText="Facebook" class="st_facebook_vcount" st_url="http://www.blogstack.info/post/blogbitix/2014/07/usar-apache-tapestry-en-una-aplicacion-standalone" st_title="Usar Apache Tapestry en una aplicación «standalone» | Blog Bitix"></span><span displayText="Google +" class="st_googleplus_vcount" st_url="http://www.blogstack.info/post/blogbitix/2014/07/usar-apache-tapestry-en-una-aplicacion-standalone" st_title="Usar Apache Tapestry en una aplicación «standalone» | Blog Bitix"></span><span displayText="LinkedIn" class="st_linkedin_vcount" st_url="http://www.blogstack.info/post/blogbitix/2014/07/usar-apache-tapestry-en-una-aplicacion-standalone" st_title="Usar Apache Tapestry en una aplicación «standalone» | Blog Bitix"></span><span displayText="Meneame" class="st_meneame_vcount" st_url="http://www.blogstack.info/post/blogbitix/2014/07/usar-apache-tapestry-en-una-aplicacion-standalone" st_title="Usar Apache Tapestry en una aplicación «standalone» | Blog Bitix"></span></div><script src="http://w.sharethis.com/button/buttons.js" type="text/javascript"></script><script type="text/javascript">stLight.options({publisher: "ur-3b2014fd-82e-9968-7e00-5ee51fb88bb2", doNotHash: true, doNotCopy: true, hashAddressBar: false});</script><div id="widget"></div></section><section><a id="comments"></a><h1>Comentar</h1><div id="disqus_thread"></div><script type="text/javascript">
var disqus_shortname = "blog-bitix";
var disqus_title = "Usar Apache Tapestry en una aplicación «standalone»";
var disqus_url = "http://picodotdev.github.io/blog-bitix/2014/07/usar-apache-tapestry-en-una-aplicacion-standalone/";
</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a class="dsq-brlink" href="http://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a></section><hr/></article></div><div class="col-xs-12 col-sm-12 col-md-4"><aside><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><section><h3>¡Suscríbete!</h3><ul class="list-unstyled"><li><a href="/label/programacion/feed.atom.xml"><span class="fa fa-rss"></span> Fuente de la etiqueta programacion</a></li><li><a href="/label/java/feed.atom.xml"><span class="fa fa-rss"></span> Fuente de la etiqueta java</a></li><li><a href="/label/software/feed.atom.xml"><span class="fa fa-rss"></span> Fuente de la etiqueta software</a></li><li><a href="/label/tapestry/feed.atom.xml"><span class="fa fa-rss"></span> Fuente de la etiqueta tapestry</a></li></ul></section></div></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><div id="bigRectangle"></div></div></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><section><h3>Redes sociales</h3><p>¿Te gusta Blog Stack? ¡Compártelo!</p><div class="social-networks"><!-- Facebook --><div class="social-network"><div data-share="true" data-show-faces="false" data-action="like" data-width="310" data-layout="box_count" data-href="http://www.blogstack.info/" class="fb-like"></div></div><!-- Google+ --><div class="social-network"><div class="g-plusone" data-href="http://www.blogstack.info/" data-size="tall"></div></div></div></section></div></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><section id="lastPosts"></section></div></div><div class="row"><div class="col-xs-3 col-md-2"><div id="wideSkycraper"></div></div></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><section id="lastPosts_0"></section></div></div></aside></div></div></div><footer><div class="container-fluid"><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><div class="footer"><a href="/">Blog Stack</a> por <a href="https://twitter.com/picodotdev/">pico.dev</a> está publicado bajo la licencia de software libre <a href="http://www.gnu.org/licenses/agpl-3.0.html">GNU Affero General Public</a> en <a href="https://github.com/picodotdev/blog-stack">GitHub <span class="entypo-social"></span></a>.<br/>
El contenido agregado conserva la licencia de su bitácora.<br/>
«Powered by» <a href="https://github.com/picodotdev/blogstack">Blog Stack</a>, <a href="http://tapestry.apache.org/">Apache Tapestry</a>, <a href="https://www.openshift.com/">OpenShift</a>, <a href="https://pages.github.com/">GitHub Pages</a>, <a href="http://www.oracle.com/es/technologies/java/overview/index.html">Java</a> y más software libre o de código abierto, inspirado en <a href="http://octopress.org/">Octopress</a>.<br/><span class="copyleft">©</span> pico.dev 2014
</div></div></div></div></footer><div id="fb-root"></div><script type="text/javascript">var require = {
  "waitSeconds" : 300,
  "shim" : {
    "t5/core/typeahead" : [
      "jquery"
    ],
    "bootstrap/affix" : [
      "bootstrap/transition"
    ],
    "bootstrap/alert" : [
      "bootstrap/transition"
    ],
    "bootstrap/modal" : [
      "bootstrap/transition"
    ],
    "bootstrap/tab" : [
      "bootstrap/transition"
    ],
    "bootstrap/transition" : [
      "jquery"
    ],
    "bootstrap/button" : [
      "bootstrap/transition"
    ],
    "bootstrap/scrollspy" : [
      "bootstrap/transition"
    ],
    "bootstrap/collapse" : [
      "bootstrap/transition"
    ],
    "bootstrap/dropdown" : [
      "bootstrap/transition"
    ],
    "bootstrap/tooltip" : [
      "bootstrap/transition"
    ],
    "bootstrap/carousel" : [
      "bootstrap/transition"
    ],
    "bootstrap/popover" : [
      "bootstrap/tooltip"
    ]
  },
  "baseUrl" : "/modules"
};
</script><script src="/assets/tapestry5/require.js" type="text/javascript"></script><script src="/assets/tapestry5/underscore-1.5.2.js" type="text/javascript"></script><script src="/assets/tapestry5/scriptaculous_1_9_0/prototype.js" type="text/javascript"></script><script src="/assets/tapestry5/scriptaculous_1_9_0/scriptaculous.js" type="text/javascript"></script><script src="/assets/tapestry5/scriptaculous_1_9_0/effects.js" type="text/javascript"></script><script src="/assets/tapestry5/t53-compatibility.js" type="text/javascript"></script><script src="/assets/tapestry5/jquery.js" type="text/javascript"></script><script src="/assets/tapestry5/jquery-noconflict.js" type="text/javascript"></script><script type="text/javascript">require(["t5/core/pageinit"], function(pi) { pi([], [
  "app/analytics",
  [
    "app/karmacracy:init",
    {
      "selector" : "#widget",
      "id" : 807,
      "url" : "http://www.blogstack.info/post/blogbitix/2014/07/usar-apache-tapestry-en-una-aplicacion-standalone"
    }
  ],
  "app/disqus",
  "app/facebook",
  "app/googleplus",
  [
    "app/lastPosts:init",
    {
      "id" : "lastPosts",
      "source" : "blogbitix",
      "name" : "Blog Bitix"
    }
  ],
  [
    "app/lastPosts:init",
    {
      "id" : "lastPosts_0",
      "source" : "blogstack",
      "name" : "Blog Stack"
    }
  ],
  [
    "app/adsensem:init",
    {
      "blogstack" : {
        "adClient" : "ca-pub-3533636310991304",
        "adSlotBillboard" : "1397019380",
        "adSlotHorizontalSkycraper" : "1397019380",
        "adSlotBigRectangle" : "2873752587",
        "adSlotWideSkycraper" : "1896546988"
      },
      "ad" : {
        "adClient" : "ca-pub-3533636310991304",
        "adSlotBillboard" : "1397019380",
        "adSlotHorizontalSkycraper" : "1397019380",
        "adSlotBigRectangle" : "2873752587",
        "adSlotWideSkycraper" : "1896546988"
      }
    }
  ]
]); });</script></body></html>