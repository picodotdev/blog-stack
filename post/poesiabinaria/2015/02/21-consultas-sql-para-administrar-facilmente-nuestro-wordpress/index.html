<!DOCTYPE html><html data-debug-enabled="true" data-locale="es_ES" xmlns="http://www.w3.org/1999/xhtml"><head><meta content="Apache Tapestry Framework (version 5.4-beta-16)" name="generator"/><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><meta pagina="Post"/><title>21 Consultas SQL para administrar fácilmente nuestro WordPress | Poesía binaria</title><!-- Resources --><link type="text/css" rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:400,700"/><link type="text/css" rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css"/><link title="Portada" type="application/atom+xml" rel="alternate" href="/feed.atom.xml"/><link type="image/png" rel="icon" href="/assets/images/favicon.png"/><meta content="Post" name="tapestry-page-name"/><link type="text/css" rel="stylesheet" href="/assets/tapestry5/bootstrap/css/bootstrap.css"/><link type="text/css" rel="stylesheet" href="/assets/tapestry5/tapestry.css"/><link type="text/css" rel="stylesheet" href="/assets/tapestry5/exception-frame.css"/><link type="text/css" rel="stylesheet" href="/assets/tapestry5/tapestry-console.css"/><link type="text/css" rel="stylesheet" href="/assets/tapestry5/tree.css"/><link type="text/css" rel="stylesheet" href="/assets/css/core.css"/></head><body data-page-initialized="false"><script type="text/javascript">document.write("<div class=\"pageloading-mask\"><div></div></div>");</script><header><div class="container-fluid"><div class="row"><div class="col-xs-12 col-sm-12 col-md-4"><h1><a class="blogstack" href="/"><span class="glyphicon glyphicon-th"></span> Blog <span class="stack">Stack</span></a></h1></div><div class="col-xs-12 col-sm-12 col-md-6"><nav role="navigation"><ul class="list-unstyled list-inline"><li><a class="header" href="/">Inicio</a></li><li><a class="header" href="/archive">Archivo</a></li><li><a class="header" href="/faq">Preguntas frecuentes</a></li><li><a class="header" href="/faq#aggregate">¿Quieres agregar tu bitácora?</a></li></ul></nav></div><div class="col-xs-6 col-sm-6 col-md-2"><a title="Fuente RSS, ¡suscríbete a BS!" alt="Fuente RSS" class="header" href="/feed.atom.xml"><span class="header icon entypo"></span></a><a title="Twitter, ¡sigue a BS!" alt="Twitter" class="header" href="http://twitter.com/blogstackinfo"><span class="header icon entypo-social"></span></a></div></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><h4>Un poco más que un agregador/planeta de bitácoras sobre programación, desarrollo, software libre, gnu/linux, tecnología, ...</h4></div></div></div><div class="container-fluid"><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><div class="imagen-cabecera"><div class="imagen"><div class="col-xs-12 col-sm-12 col-md-12" id="billboard"></div></div></div></div></div></div></header><div class="container-fluid content"><div class="row"><div class="col-xs-12 col-sm-12 col-md-8 content"><article itemtype="http://schema.org/BlogPosting" itemscope=""><a id="content"></a><header><h2><a href="/post/poesiabinaria/2015/02/21-consultas-sql-para-administrar-facilmente-nuestro-wordpress"><span itemprop="headline">21 Consultas SQL para administrar fácilmente nuestro WordPress</span></a></h2></header><div class="row labels"><div class="col-md-12"><a class="label" href="/label/seguridad"><img title="seguridad" alt="seguridad" src="/assets/images/labels/seguridad.png"/></a><a class="label" href="/label/mysql"><img title="mysql" alt="mysql" src="/assets/images/labels/mysql.png"/></a></div></div><section class="post-data"><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><div><span>Escrito por <span itemprop="author">Gaspar Fernández</span> en la bitácora <a href="http://totaki.com/poesiabinaria/">Poesía binaria</a>, <a href="http://totaki.com/poesiabinaria/2015/02/wordpress-sql/"><span itemprop="sameAs">artículo original</span></a></span></div><div><span datetime="2015-02-11T09:03" itemprop="datePublished">Publicado el miércoles, 11 de febrero de 2015 a las 09:03 UTC</span></div><div><span>
Etiquetado como
usuarios, backup, mysqldump, comentarios, guid, recuento, informacion, <a href="/label/seguridad"><span itemprop="articleSection">seguridad</span></a>, direcciones, migracion, url, vieja, paginas, consulta, copia, <a href="/label/mysql"><span itemprop="articleSection">mysql</span></a>, nueva, posts, ip, permalink, spam, wordpress, sql, general</span></div></div></div></section><div class="text-justify post-content"><div class="share-this only-twitter"><span displayText="Tweet" class="st_twitter_vcount" st_url="http://www.blogstack.info/post/poesiabinaria/2015/02/21-consultas-sql-para-administrar-facilmente-nuestro-wordpress" st_title="21 Consultas SQL para administrar fácilmente nuestro WordPress | Poesía binaria"></span></div><script src="http://w.sharethis.com/button/buttons.js" type="text/javascript"></script><script type="text/javascript">stLight.options({publisher: "ur-3b2014fd-82e-9968-7e00-5ee51fb88bb2", doNotHash: true, doNotCopy: true, hashAddressBar: false});</script><span itemprop="name"><p><a href="http://totaki.com/poesiabinaria/wp-content/plugins/wordpress-feed-statistics/feed-statistics.php?url=aHR0cDovL3RvdGFraS5jb20vcG9lc2lhYmluYXJpYS93cC1jb250ZW50L3VwbG9hZHMvMjAxNS8wMi93cF9zcWwuanBn"><img src="http://totaki.com/poesiabinaria/wp-content/uploads/2015/02/wp_sql.jpg" alt="" title="wp_sql" width="708" height="585" /></a></p> 
<p>Muchas veces cuando trabajamos con WordPress hacemos uso directamente de alg&uacute;n plugin, dentro de la infinidad de ellos que tenemos disponible, lo cual est&aacute; muy bien pero a veces nos despegamos un poco de los or&iacute;genes. MySQL est&aacute; hecho para usar MySQL (o MariaDB), hace consultas como todos los dem&aacute;s y &iexcl;<strong>podemos aprovecharnos de ello</strong>! (e ir mucho m&aacute;s r&aacute;pido).</p> 
<p>Antes de nada, he supuesto que el prefijo de las tablas es el que viene por defecto: “<strong>wp_</strong>“, si no es as&iacute;, c&aacute;mbialo por el que tengas.</p> 
<p>Aunque est&aacute; organizado todo en 14 tramos, como v&eacute;is hay muchas consultas listas para copiar y pegar</p> 
<h2>Backup de nuestra instalaci&oacute;n</h2> 
<p>Lo primero, como siempre, antes de tocar nada es hacer una copia de seguridad de nuestra base de datos (si es posible de los archivos, nunca est&aacute; de m&aacute;s). Podemos hacerlo desde PHPMyAdmin, o si tenemos una terminal cerca, podemos utilizar mysqldump:</p> 
<blockquote>
 <p>$ mysqldump -u[usuario] -p[contrase&ntilde;a] [basededatos] &gt; archivo.sql</p>
</blockquote> 
<p>Si no queremos dejar la contrase&ntilde;a en el termina, no la ponemos y nos la preguntar&aacute; antes de hacer la copia.</p> 
<p>Para restaurar, sencillamente haremos:</p> 
<blockquote>
 <p>$ mysql -u[usuario] -p[contrase&ntilde;a] [basededatos] </p>
</blockquote> 
<p>y ante cualquier problema podemos volver al estado anterior f&aacute;cilmente.</p> 
<h2>1 – Migraciones indoloras</h2> 
<p>Cuando migramos un wordpress de un servidor a otro, normalmente no funcionar&aacute; en la nueva URL, tenemos que cambiar algunas cosas de sitio, y eso lo podemos hacer directamente en base de datos.</p> 
<div style="overflow:auto;white-space:nowrap;border:1px solid #9F9F9F;width:435px;">
 <table>
  <tbody>
   <tr>
    <td>
     <div>
      1
      <br />2
      <br />3
      <br />4
      <br />
     </div></td>
    <td>
     <div style="padding:5px;font:normal 12px/1.4em Monaco, Lucida Console, monospace;white-space:nowrap">
      UPDATE wp_options SET option_value = REPLACE(option_value, 'http://antigua.web', 'http://nueva.web') 
      <br /> &nbsp; WHERE option_name = 'siteurl';
      <br /> UPDATE wp_options SET option_value = REPLACE(option_value, 'http://antigua.web', 'http://nueva.web') 
      <br /> &nbsp; WHERE option_name = 'home';
     </div></td>
   </tr>
  </tbody>
 </table>
</div> 
<p>No es una buena idea hacerlo en la tabla completa, ya que algunos desarrolladores tienen la (mala) costumbre de meter URLs en elementos serializados, por lo que si la nueva url no tiene el mismo n&uacute;mero de letras que la antigua, tenemos que aplicar otras t&eacute;cnicas para poder realizar la migraci&oacute;n.</p> 
<p>Con esto cambiamos la url de la p&aacute;gina. Ahora vamos a echarle un ojo a los permalinks:</p> 
<div style="overflow:auto;white-space:nowrap;border:1px solid #9F9F9F;width:435px;">
 <table>
  <tbody>
   <tr>
    <td>
     <div>
      1
      <br />
     </div></td>
    <td>
     <div style="padding:5px;font:normal 12px/1.4em Monaco, Lucida Console, monospace;white-space:nowrap">
      UPDATE wp_posts SET guid = REPLACE(guid, 'http://antigua.web', 'http://nueva.web');
     </div></td>
   </tr>
  </tbody>
 </table>
</div> 
<p>Ahora, en el contenido de los posts:</p> 
<div style="overflow:auto;white-space:nowrap;border:1px solid #9F9F9F;width:435px;">
 <table>
  <tbody>
   <tr>
    <td>
     <div>
      1
      <br />
     </div></td>
    <td>
     <div style="padding:5px;font:normal 12px/1.4em Monaco, Lucida Console, monospace;white-space:nowrap">
      UPDATE wp_posts SET post_content = REPLACE (post_content, 'http://antigua.web', 'http://nueva.web');
     </div></td>
   </tr>
  </tbody>
 </table>
</div> 
<p>Por &uacute;ltimo en los metadatos:</p> 
<div style="overflow:auto;white-space:nowrap;border:1px solid #9F9F9F;width:435px;">
 <table>
  <tbody>
   <tr>
    <td>
     <div>
      1
      <br />
     </div></td>
    <td>
     <div style="padding:5px;font:normal 12px/1.4em Monaco, Lucida Console, monospace;white-space:nowrap">
      UPDATE wp_postmeta SET meta_value = REPLACE (meta_value, 'http://antigua.web', 'http://nueva.web');
     </div></td>
   </tr>
  </tbody>
 </table>
</div> 
<h2>2 – Listar los comentarios del &uacute;ltimo a&ntilde;o</h2> 
<div style="overflow:auto;white-space:nowrap;border:1px solid #9F9F9F;width:435px;">
 <table>
  <tbody>
   <tr>
    <td>
     <div>
      1
      <br />2
      <br />3
      <br />4
      <br />
     </div></td>
    <td>
     <div style="padding:5px;font:normal 12px/1.4em Monaco, Lucida Console, monospace;white-space:nowrap">
      SELECT * FROM wp_comments 
      <br /> &nbsp; &nbsp;WHERE comment_date&gt;='2014-01-01' AND comment_date&lt;'2015-01-01' 
      <br /> &nbsp; &nbsp; &nbsp; AND comment_approved=1 
      <br /> &nbsp; &nbsp; &nbsp; AND comment_type&lt;&gt;'trackback' AND comment_type&lt;&gt;'pingback';
     </div></td>
   </tr>
  </tbody>
 </table>
</div> 
<p>En este caso, estamos pidiendo los comentarios desde el 1 de Enero del 2014 (a&ntilde;o-mes-d&iacute;a) hasta justo antes del 1 de Enero de 2015, eso s&iacute;, que est&eacute;n aprobados y no sean trackbacks ni pingbacks.</p> 
<p>Del mismo modo podemos listar s&oacute;lo los comentarios que no son nuestros:</p> 
<div style="overflow:auto;white-space:nowrap;border:1px solid #9F9F9F;width:435px;">
 <table>
  <tbody>
   <tr>
    <td>
     <div>
      1
      <br />2
      <br />3
      <br />4
      <br />5
      <br />
     </div></td>
    <td>
     <div style="padding:5px;font:normal 12px/1.4em Monaco, Lucida Console, monospace;white-space:nowrap">
      SELECT * FROM wp_comments 
      <br /> &nbsp; &nbsp;WHERE comment_date&gt;='2014-01-01' AND comment_date&lt;'2015-01-01' 
      <br /> &nbsp; &nbsp; &nbsp; AND comment_approved=1 
      <br /> &nbsp; &nbsp; &nbsp; AND comment_type&lt;&gt;'trackback' AND comment_type&lt;&gt;'pingback'
      <br /> &nbsp; &nbsp; &nbsp; AND comment_author_email&lt;&gt;'mi@correo.ext';
     </div></td>
   </tr>
  </tbody>
 </table>
</div> 
<p>O por ejemplo, obtener un listado de lo m&aacute;s comentado desde el 2014</p> 
<div style="overflow:auto;white-space:nowrap;border:1px solid #9F9F9F;width:435px;">
 <table>
  <tbody>
   <tr>
    <td>
     <div>
      1
      <br />2
      <br />3
      <br />4
      <br />5
      <br />6
      <br />7
      <br />8
      <br />9
      <br />10
      <br />11
      <br />12
      <br />
     </div></td>
    <td>
     <div style="padding:5px;font:normal 12px/1.4em Monaco, Lucida Console, monospace;white-space:nowrap">
      SELECT CASE WHEN LENGTH(wpp.post_title) &gt; 55 
      <br /> &nbsp; &nbsp; &nbsp; &nbsp;THEN CONCAT(SUBSTRING(wpp.post_title, 1, 55), '...') 
      <br /> &nbsp; &nbsp; &nbsp; &nbsp;ELSE wpp.post_title END AS title, wpp.post_date, `comment_post_ID`, 
      <br /> &nbsp; &nbsp;COUNT(*) AS amount 
      <br /> &nbsp; &nbsp;FROM `wp_comments` wpc 
      <br /> &nbsp; &nbsp; &nbsp; JOIN wp_posts wpp ON wpc.comment_post_id=wpp.ID 
      <br /> &nbsp; &nbsp;WHERE `comment_approved` = '1' 
      <br /> &nbsp; &nbsp; &nbsp; AND comment_date&gt;='2014-01-01' 
      <br /> &nbsp; &nbsp; &nbsp; AND comment_type&lt;&gt;'pingback' 
      <br /> &nbsp; &nbsp; &nbsp; AND comment_type&lt;&gt;'trackback' 
      <br /> &nbsp; &nbsp;GROUP BY `comment_post_ID` 
      <br /> &nbsp; &nbsp;ORDER BY amount DESC;
     </div></td>
   </tr>
  </tbody>
 </table>
</div> 
<p>Con esta consulta recibimos un listado con los t&iacute;tulos de los posts (recortados, porque hay algunos muy largos), la fecha de publicaci&oacute;n y el n&uacute;mero de comentarios recibidos desde la fecha especificada.</p> 
<h2>3 – Posts escritos en el &uacute;ltimo a&ntilde;o</h2> 
<div style="overflow:auto;white-space:nowrap;border:1px solid #9F9F9F;width:435px;">
 <table>
  <tbody>
   <tr>
    <td>
     <div>
      1
      <br />
     </div></td>
    <td>
     <div style="padding:5px;font:normal 12px/1.4em Monaco, Lucida Console, monospace;white-space:nowrap">
      SELECT COUNT(*) FROM wp_posts WHERE post_date&gt;='2014-01-01' AND post_date&lt;'2015-01-01';
     </div></td>
   </tr>
  </tbody>
 </table>
</div> 
<p>Si queremos m&aacute;s informaci&oacute;n, podemos seleccionar informaci&oacute;n sobre esos posts para verlos m&aacute;s detenidamente:</p> 
<div style="overflow:auto;white-space:nowrap;border:1px solid #9F9F9F;width:435px;">
 <table>
  <tbody>
   <tr>
    <td>
     <div>
      1
      <br />2
      <br />3
      <br />4
      <br />
     </div></td>
    <td>
     <div style="padding:5px;font:normal 12px/1.4em Monaco, Lucida Console, monospace;white-space:nowrap">
      SELECT post_name, post_title 
      <br /> &nbsp; &nbsp;FROM wp_posts wpp 
      <br /> &nbsp; &nbsp;WHERE post_date&gt;='2014-01-01' AND post_date&lt;'2015-01-01' 
      <br /> &nbsp; &nbsp;AND post_status='publish';
     </div></td>
   </tr>
  </tbody>
 </table>
</div> 
<h2>4 – Borrar pingbacks</h2> 
<p>A veces los posts se nos llenan de pingbacks y puede que se descontrole. Podemos hacer:</p> 
<div style="overflow:auto;white-space:nowrap;border:1px solid #9F9F9F;width:435px;">
 <table>
  <tbody>
   <tr>
    <td>
     <div>
      1
      <br />
     </div></td>
    <td>
     <div style="padding:5px;font:normal 12px/1.4em Monaco, Lucida Console, monospace;white-space:nowrap">
      DELETE FROM wp_comments WHERE comment_type='pingback';
     </div></td>
   </tr>
  </tbody>
 </table>
</div> 
<p>Si por ejemplo quieres borrar los pingbacks de una serie de posts (o de uno solo):</p> 
<div style="overflow:auto;white-space:nowrap;border:1px solid #9F9F9F;width:435px;">
 <table>
  <tbody>
   <tr>
    <td>
     <div>
      1
      <br />2
      <br />
     </div></td>
    <td>
     <div style="padding:5px;font:normal 12px/1.4em Monaco, Lucida Console, monospace;white-space:nowrap">
      DELETE FROM wp_comments WHERE Comment_type='pingback' 
      <br /> &nbsp; &nbsp;AND comment_post_ID IN (IdPost1, IdPost2, ...)
     </div></td>
   </tr>
  </tbody>
 </table>
</div> 
<h2>5 – Listar las IPs desde las que te llega SPAM</h2> 
<p>Es muy &uacute;til si queremos <strong>a&ntilde;adir IPs a listas negras</strong> por el n&uacute;mero de comentarios de SPAM que nos llegan de ellas.</p> 
<div style="overflow:auto;white-space:nowrap;border:1px solid #9F9F9F;width:435px;">
 <table>
  <tbody>
   <tr>
    <td>
     <div>
      1
      <br />
     </div></td>
    <td>
     <div style="padding:5px;font:normal 12px/1.4em Monaco, Lucida Console, monospace;white-space:nowrap">
      SELECT comment_author_ip, COUNT(*) AS times FROM wp_comments pc GROUP BY comment_author_ip HAVING times&gt;5;
     </div></td>
   </tr>
  </tbody>
 </table>
</div> 
<p>Con esta consulta vemos las IPs &uacute;nicas que nos han mandado comentarios, junto con el n&uacute;mero de veces que han comentado. Tambi&eacute;n, esta consulta la hacemos siempre que haya m&aacute;s de 5 comentarios de SPAM (ya que puede haber muchas que s&oacute;lo hayan enviado 1 &oacute; 2 y a lo mejor nos dificultan el trabajo m&aacute;s que ayudar).</p> 
<h2>6 – Listar los posts desde los que entra m&aacute;s SPAM</h2> 
<p>Muy parecida a una consulta anterior (para ver los posts m&aacute;s comentados).</p> 
<div style="overflow:auto;white-space:nowrap;border:1px solid #9F9F9F;width:435px;">
 <table>
  <tbody>
   <tr>
    <td>
     <div>
      1
      <br />2
      <br />3
      <br />4
      <br />5
      <br />6
      <br />7
      <br />8
      <br />9
      <br />
     </div></td>
    <td>
     <div style="padding:5px;font:normal 12px/1.4em Monaco, Lucida Console, monospace;white-space:nowrap">
      SELECT CASE WHEN LENGTH(wpp.post_title) &gt; 55 
      <br /> &nbsp; &nbsp; &nbsp; &nbsp;THEN CONCAT(SUBSTRING(wpp.post_title, 1, 55), '...') 
      <br /> &nbsp; &nbsp; &nbsp; &nbsp;ELSE wpp.post_title END AS title, wpp.post_date, `comment_post_ID`, 
      <br /> &nbsp; &nbsp;COUNT(*) AS amount 
      <br /> &nbsp; &nbsp;FROM `wp_comments` wpc 
      <br /> &nbsp; &nbsp; &nbsp; JOIN wp_posts wpp ON wpc.comment_post_id=wpp.ID 
      <br /> &nbsp; &nbsp;WHERE `comment_approved` = 'spam' 
      <br /> &nbsp; &nbsp;GROUP BY `comment_post_ID` 
      <br /> &nbsp; &nbsp;ORDER BY amount DESC;
     </div></td>
   </tr>
  </tbody>
 </table>
</div> 
<h2>7 – Abrir o cerrar los comentarios de ciertos posts</h2> 
<p>Si queremos desactivar los comentarios en posts antiguos, podemos hacer:</p> 
<div style="overflow:auto;white-space:nowrap;border:1px solid #9F9F9F;width:435px;">
 <table>
  <tbody>
   <tr>
    <td>
     <div>
      1
      <br />2
      <br />
     </div></td>
    <td>
     <div style="padding:5px;font:normal 12px/1.4em Monaco, Lucida Console, monospace;white-space:nowrap">
      UPDATE wp_posts SET comment_status='closed' WHERE post_type = 'post' 
      <br /> &nbsp; &nbsp;AND post_date&lt;='2014-01-01';
     </div></td>
   </tr>
  </tbody>
 </table>
</div> 
<p>Y de forma parecida podemos jugar con el WHERE para determinar fechas mayores/menores o diferentes tipos de post.<br /> Tambi&eacute;n podemos poner comment_status a ‘<strong>opened</strong>‘ para permitir de nuevo comentarios.</p> 
<h2>8 – Borrar comentarios de SPAM</h2> 
<p>Yo he llegado a tener en alg&uacute;n momento cientos de miles de comentarios de SPAM (nada, a los bots parece que les gusta), llega un momento que la base de datos ocupa mucho y podemos limpiarlo todo de un plumazo:</p> 
<div style="overflow:auto;white-space:nowrap;border:1px solid #9F9F9F;width:435px;">
 <table>
  <tbody>
   <tr>
    <td>
     <div>
      1
      <br />
     </div></td>
    <td>
     <div style="padding:5px;font:normal 12px/1.4em Monaco, Lucida Console, monospace;white-space:nowrap">
      DELETE FROM wp_comments WHERE comment_approved = 'spam';
     </div></td>
   </tr>
  </tbody>
 </table>
</div> 
<h2>9 – Identificar tags no utilizados</h2> 
<p>Si hemos borrado alg&uacute;n post, normalmente los tags y otros metadatos se quedan presentes en base de datos. Y con eso salen en las nubes de tags (aunque con un peso 0 lo &uacute;nico que hacen es hacerla m&aacute;s lenta). Tambi&eacute;n debemos recordar que si actualmente tienes posts programados, estos posts a&uacute;n no han cogido sus etiquetas, y por tanto, &eacute;stas estar&aacute;n en esta lista. As&iacute; que, cuidado cuando vayamos a borrarlas.</p> 
<div style="overflow:auto;white-space:nowrap;border:1px solid #9F9F9F;width:435px;">
 <table>
  <tbody>
   <tr>
    <td>
     <div>
      1
      <br />2
      <br />3
      <br />4
      <br />5
      <br />
     </div></td>
    <td>
     <div style="padding:5px;font:normal 12px/1.4em Monaco, Lucida Console, monospace;white-space:nowrap">
      SELECT * FROM wp_terms wt 
      <br /> &nbsp; &nbsp;INNER JOIN wp_term_taxonomy wtt 
      <br /> &nbsp; &nbsp; &nbsp; ON wt.term_id=wtt.term_id 
      <br /> &nbsp; &nbsp;WHERE wtt.taxonomy='post_tag' 
      <br /> &nbsp; &nbsp; &nbsp; AND wtt.COUNT=0;
     </div></td>
   </tr>
  </tbody>
 </table>
</div> 
<h2>10 – Ver listado de personas que han comentado en tu blog</h2> 
<p>Si queremos obtener un listado &uacute;nico de personas que han comentado (identificadas por su correo electr&oacute;nico), esta consulta viene muy bien. Adem&aacute;s, sacamos informaci&oacute;n como la URL de la web (si la han dejado). Cuidado con los trackbacks y pingbacks (en esta query nos los quitamos del medio).<br /><strong>Utiliza esta informaci&oacute;n de forma responsable, no hagas SPAM</strong></p> 
<div style="overflow:auto;white-space:nowrap;border:1px solid #9F9F9F;width:435px;">
 <table>
  <tbody>
   <tr>
    <td>
     <div>
      1
      <br />2
      <br />3
      <br />4
      <br />5
      <br />
     </div></td>
    <td>
     <div style="padding:5px;font:normal 12px/1.4em Monaco, Lucida Console, monospace;white-space:nowrap">
      SELECT comment_author, comment_author_email, comment_author_url 
      <br /> &nbsp; &nbsp; FROM wp_comments 
      <br /> &nbsp; &nbsp; WHERE comment_type&lt;&gt;'pingback' 
      <br /> &nbsp; &nbsp; &nbsp; &nbsp;AND comment_type&lt;&gt;'trackback' 
      <br /> &nbsp; &nbsp; GROUP BY comment_author_email;
     </div></td>
   </tr>
  </tbody>
 </table>
</div> 
<h2>11 – Eliminar borradores antiguos</h2> 
<p>A veces se nos pueden acumular borradores antiguos en la base de datos, pues bien, para deshacernos de ellos:</p> 
<div style="overflow:auto;white-space:nowrap;border:1px solid #9F9F9F;width:435px;">
 <table>
  <tbody>
   <tr>
    <td>
     <div>
      1
      <br />
     </div></td>
    <td>
     <div style="padding:5px;font:normal 12px/1.4em Monaco, Lucida Console, monospace;white-space:nowrap">
      DELETE FROM wp_posts wpp WHERE post_status='draft' AND post_date&lt;'2015-01-01';
     </div></td>
   </tr>
  </tbody>
 </table>
</div> 
<p>He puesto de fecha el 1 de Enero de 2015 (a&ntilde;o-mes-d&iacute;a). <strong>Cuidado cuando estemos borrando,</strong> hemos de comprobar dos veces lo que estamos haciendo!!</p> 
<h2>12 – Eliminar revisiones</h2> 
<div style="overflow:auto;white-space:nowrap;border:1px solid #9F9F9F;width:435px;">
 <table>
  <tbody>
   <tr>
    <td>
     <div>
      1
      <br />2
      <br />3
      <br />4
      <br />5
      <br />
     </div></td>
    <td>
     <div style="padding:5px;font:normal 12px/1.4em Monaco, Lucida Console, monospace;white-space:nowrap">
      A lo largo de los a&ntilde;os seguro que se nos acumulan cientos de revisiones de posts, y eso sobrecarga la base de datos
      <br /> DELETE a,b,c FROM wp_posts a
      <br /> &nbsp; LEFT JOIN wp_term_relationships b ON (a.ID = b.object_id)
      <br /> &nbsp; LEFT JOIN wp_postmeta c ON (a.ID = c.post_id)
      <br /> &nbsp; WHERE a.post_type = 'revision'
     </div></td>
   </tr>
  </tbody>
 </table>
</div> 
<h2>13 – Insertar un campo personalizado en todos los posts</h2> 
<div style="overflow:auto;white-space:nowrap;border:1px solid #9F9F9F;width:435px;">
 <table>
  <tbody>
   <tr>
    <td>
     <div>
      1
      <br />2
      <br />3
      <br />4
      <br />5
      <br />
     </div></td>
    <td>
     <div style="padding:5px;font:normal 12px/1.4em Monaco, Lucida Console, monospace;white-space:nowrap">
      INSERT INTO wp_postmeta (post_id, meta_key, meta_value)
      <br /> &nbsp; SELECT ID AS post_id, 'MiNuevoCampo' AS meta_key, 'MiNuevoValor' AS meta_value
      <br /> &nbsp; &nbsp; FROM wp_posts WHERE ID NOT IN
      <br /> &nbsp; &nbsp; &nbsp; &nbsp;(SELECT post_id FROM wp_postmeta WHERE meta_key = 'MiNuevoCampo')
      <br /> &nbsp; &nbsp; AND `post_type` = 'post';
     </div></td>
   </tr>
  </tbody>
 </table>
</div> 
<p>Podemos jugar con el post_type y con todas las propiedades que hemos visto antes.</p> 
<h2>14 – Saber en qu&eacute; posts tenemos un determinado shortcode</h2> 
<div style="overflow:auto;white-space:nowrap;border:1px solid #9F9F9F;width:435px;">
 <table>
  <tbody>
   <tr>
    <td>
     <div>
      1
      <br />2
      <br />3
      <br />4
      <br />5
      <br />
     </div></td>
    <td>
     <div style="padding:5px;font:normal 12px/1.4em Monaco, Lucida Console, monospace;white-space:nowrap">
      SELECT post_name,post_status,post_title 
      <br /> &nbsp; &nbsp;FROM wp_posts 
      <br /> &nbsp; &nbsp;WHERE post_type = 'post' 
      <br /> &nbsp; &nbsp; &nbsp; AND post_status NOT LIKE '%draft' 
      <br /> &nbsp; &nbsp; &nbsp; AND post_content LIKE '%[shortcode%';
     </div></td>
   </tr>
  </tbody>
 </table>
</div> 
<p>La b&uacute;squeda del shortcode no es de lo mejor, porque busca “<em>[shortcode</em>” en todos los posts, si el shortcode sabemos seguro que est&aacute; cerrado, podemos buscarlo cerrado tambi&eacute;n.</p> 
<p>Algo parecido nos vale para encontrar una palabra mal escrita en todos nuestros posts, por ejemplo<br /> M&aacute;s info:<br /><a href="http://totaki.com/poesiabinaria/wp-content/plugins/wordpress-feed-statistics/feed-statistics.php?url=aHR0cDovL3d3dy5vbmV4dHJhcGl4ZWwuY29tLzIwMTAvMDEvMzAvMTMtdXNlZnVsLXdvcmRwcmVzcy1zcWwtcXVlcmllcy15b3Utd2lzaC15b3Uta25ldy1lYXJsaWVyLw==">13 useful WordPress SQL Queries You Wish You new Earlier</a> (He cogido dos queries de esta web que la encontr&eacute; mientras estaba escribiendo este post)<br /><a href="http://totaki.com/poesiabinaria/wp-content/plugins/wordpress-feed-statistics/feed-statistics.php?url=aHR0cDovL3RoZWN1c3RvbWl6ZXdpbmRvd3MuY29tLzIwMTEvMDMvaW5kaXNwZW5zYWJsZS1teXNxbC1xdWVyaWVzLWZvci1jdXN0b20tZmllbGRzLWluLXdvcmRwcmVzcy8=">Indispensable MySQL Queries For Custom Fields In WordPress</a> – De aqu&iacute; saqu&eacute; la de la creaci&oacute;n de un campo personalizado en todos los posts</p> 
<div>
 <iframe src="http://www.facebook.com/plugins/like.php?href=http%3A%2F%2Ftotaki.com%2Fpoesiabinaria%2F2015%2F02%2Fwordpress-sql%2F&amp;layout=standard&amp;show_faces=true&amp;width=500&amp;action=like&amp;font=segoe+ui&amp;colorscheme=light&amp;height=80" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:500px; height:80px;"></iframe>
</div> 
<img src="http://totaki.com/poesiabinaria/wp-content/plugins/wordpress-feed-statistics/feed-statistics.php?view=1&amp;post_id=2466" width="1" height="1" style="display: none;" />
<p>La entrada <a href="http://totaki.com/poesiabinaria/2015/02/wordpress-sql/">21 Consultas SQL para administrar f&aacute;cilmente nuestro WordPress</a> aparece primero en <a href="http://totaki.com/poesiabinaria">Poes&iacute;a Binaria</a>.</p></span></div><section><a id="share"></a><h1>Compartir</h1><div class="share-this"><span displayText="Tweet" class="st_twitter_vcount" st_url="http://www.blogstack.info/post/poesiabinaria/2015/02/21-consultas-sql-para-administrar-facilmente-nuestro-wordpress" st_title="21 Consultas SQL para administrar fácilmente nuestro WordPress | Poesía binaria"></span><span displayText="Facebook" class="st_facebook_vcount" st_url="http://www.blogstack.info/post/poesiabinaria/2015/02/21-consultas-sql-para-administrar-facilmente-nuestro-wordpress" st_title="21 Consultas SQL para administrar fácilmente nuestro WordPress | Poesía binaria"></span><span displayText="Google +" class="st_googleplus_vcount" st_url="http://www.blogstack.info/post/poesiabinaria/2015/02/21-consultas-sql-para-administrar-facilmente-nuestro-wordpress" st_title="21 Consultas SQL para administrar fácilmente nuestro WordPress | Poesía binaria"></span><span displayText="LinkedIn" class="st_linkedin_vcount" st_url="http://www.blogstack.info/post/poesiabinaria/2015/02/21-consultas-sql-para-administrar-facilmente-nuestro-wordpress" st_title="21 Consultas SQL para administrar fácilmente nuestro WordPress | Poesía binaria"></span><span displayText="Meneame" class="st_meneame_vcount" st_url="http://www.blogstack.info/post/poesiabinaria/2015/02/21-consultas-sql-para-administrar-facilmente-nuestro-wordpress" st_title="21 Consultas SQL para administrar fácilmente nuestro WordPress | Poesía binaria"></span></div><script src="http://w.sharethis.com/button/buttons.js" type="text/javascript"></script><script type="text/javascript">stLight.options({publisher: "ur-3b2014fd-82e-9968-7e00-5ee51fb88bb2", doNotHash: true, doNotCopy: true, hashAddressBar: false});</script><div id="widget"></div></section><hr/></article></div><div class="col-xs-12 col-sm-12 col-md-4"><aside><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><section><h3>¡Suscríbete!</h3><ul class="list-unstyled"><li><a href="/label/seguridad/feed.atom.xml"><span class="fa fa-rss"></span> Fuente de la etiqueta seguridad</a></li><li><a href="/label/mysql/feed.atom.xml"><span class="fa fa-rss"></span> Fuente de la etiqueta mysql</a></li></ul></section></div></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><div id="bigRectangle"></div></div></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><section><h3>Redes sociales</h3><p>¿Te gusta Blog Stack? ¡Compártelo!</p><div class="social-networks"><!-- Facebook --><div class="social-network"><div data-share="true" data-show-faces="false" data-action="like" data-width="310" data-layout="box_count" data-href="http://www.blogstack.info/" class="fb-like"></div></div><!-- Google+ --><div class="social-network"><div class="g-plusone" data-href="http://www.blogstack.info/" data-size="tall"></div></div></div></section></div></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><section id="lastPosts"></section></div></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><div id="bigSkycraper"></div></div></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><section id="lastPosts_0"></section></div></div></aside></div></div></div><footer><div class="container-fluid"><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><div class="footer"><a href="/">Blog Stack</a> por <a href="https://twitter.com/picodotdev/">pico.dev</a> está publicado bajo la licencia de software libre <a href="http://www.gnu.org/licenses/agpl-3.0.html">GNU Affero General Public</a> en <a href="https://github.com/picodotdev/blog-stack">GitHub <span class="entypo-social"></span></a>.<br/>
El contenido agregado conserva la licencia de su bitácora.<br/>
«Powered by» <a href="https://github.com/picodotdev/blogstack">Blog Stack</a>, <a href="http://tapestry.apache.org/">Apache Tapestry</a>, <a href="https://www.openshift.com/">OpenShift</a>, <a href="https://pages.github.com/">GitHub Pages</a>, <a href="http://www.oracle.com/es/technologies/java/overview/index.html">Java</a> y más software libre o de código abierto, inspirado en <a href="http://octopress.org/">Octopress</a>.<br/><span class="copyleft">©</span> pico.dev 2015
</div></div></div></div></footer><div id="fb-root"></div><script type="text/javascript">var require = {
  "waitSeconds" : 300,
  "shim" : {
    "t5/core/typeahead" : [
      "jquery"
    ],
    "bootstrap/affix" : [
      "bootstrap/transition"
    ],
    "bootstrap/alert" : [
      "bootstrap/transition"
    ],
    "bootstrap/modal" : [
      "bootstrap/transition"
    ],
    "bootstrap/tab" : [
      "bootstrap/transition"
    ],
    "bootstrap/transition" : [
      "jquery"
    ],
    "bootstrap/button" : [
      "bootstrap/transition"
    ],
    "bootstrap/scrollspy" : [
      "bootstrap/transition"
    ],
    "bootstrap/collapse" : [
      "bootstrap/transition"
    ],
    "bootstrap/dropdown" : [
      "bootstrap/transition"
    ],
    "bootstrap/tooltip" : [
      "bootstrap/transition"
    ],
    "bootstrap/carousel" : [
      "bootstrap/transition"
    ],
    "bootstrap/popover" : [
      "bootstrap/tooltip"
    ]
  },
  "baseUrl" : "/modules"
};
</script><script src="/assets/tapestry5/require.js" type="text/javascript"></script><script src="/assets/tapestry5/underscore-1.5.2.js" type="text/javascript"></script><script src="/assets/tapestry5/scriptaculous_1_9_0/prototype.js" type="text/javascript"></script><script src="/assets/tapestry5/scriptaculous_1_9_0/scriptaculous.js" type="text/javascript"></script><script src="/assets/tapestry5/scriptaculous_1_9_0/effects.js" type="text/javascript"></script><script src="/assets/tapestry5/t53-compatibility.js" type="text/javascript"></script><script src="/assets/tapestry5/jquery.js" type="text/javascript"></script><script src="/assets/tapestry5/jquery-noconflict.js" type="text/javascript"></script><script type="text/javascript">require(["t5/core/pageinit"], function(pi) { pi([], [
  "app/analytics",
  [
    "app/karmacracy:init",
    {
      "selector" : "#widget",
      "id" : 1453,
      "url" : "http://www.blogstack.info/post/poesiabinaria/2015/02/21-consultas-sql-para-administrar-facilmente-nuestro-wordpress"
    }
  ],
  "app/facebook",
  "app/googleplus",
  [
    "app/lastPosts:init",
    {
      "id" : "lastPosts",
      "source" : "poesiabinaria",
      "name" : "Poesía binaria"
    }
  ],
  [
    "app/lastPosts:init",
    {
      "id" : "lastPosts_0",
      "source" : "blogstack",
      "name" : "Blog Stack"
    }
  ],
  [
    "app/adsensem:init",
    {
      "blogstack" : {
        "adClient" : "ca-pub-3533636310991304",
        "adSlot" : "1397019380"
      }
    }
  ]
]); });</script></body></html>